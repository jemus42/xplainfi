<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Perturbation-based Feature Importance Methods • xplainfi</title>
<!-- mathjax math --><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script><script>
  window.MathJax = {
    chtml: {
      fontURL: "https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/output/chtml/fonts/woff-v2"
    }
  };
</script><script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Roboto-0.4.10/font.css" rel="stylesheet">
<link href="../deps/JetBrains_Mono-0.4.10/font.css" rel="stylesheet">
<link href="../deps/Roboto_Slab-0.4.10/font.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Perturbation-based Feature Importance Methods">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">xplainfi</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Unreleased version">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/xplainfi.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/perturbation-importance.html">Perturbation-based Feature Importance Methods</a></li>
    <li><a class="dropdown-item" href="../articles/loco-loci.html">LOCO and LOCI</a></li>
    <li><a class="dropdown-item" href="../articles/sage-methods.html">Shapley Additive Global Importance (SAGE)</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../articles/index.html">More articles...</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/jemus42/xplainfi/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Perturbation-based Feature Importance Methods</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/jemus42/xplainfi/blob/main/vignettes/perturbation-importance.Rmd" class="external-link"><code>vignettes/perturbation-importance.Rmd</code></a></small>
      <div class="d-none name"><code>perturbation-importance.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://jemus42.github.io/xplainfi/">xplainfi</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mlr3.mlr-org.com" class="external-link">mlr3</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mlr3learners.mlr-org.com" class="external-link">mlr3learners</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span></code></pre></div>
<p>This vignette demonstrates the three perturbation-based feature
importance methods implemented in xplainfi:</p>
<ul>
<li>
<strong>PFI (Permutation Feature Importance)</strong>: Uses marginal
sampling (simple permutation)</li>
<li>
<strong>CFI (Conditional Feature Importance)</strong>: Uses
conditional sampling via Adversarial Random Forests</li>
<li>
<strong>RFI (Relative Feature Importance)</strong>: Uses conditional
sampling on a user-specified subset of features</li>
</ul>
<div class="section level2">
<h2 id="problem-setup-friedman1-task">Problem Setup: Friedman1 Task<a class="anchor" aria-label="anchor" href="#problem-setup-friedman1-task"></a>
</h2>
<p>We’ll use the Friedman1 task generator which provides an ideal setup
for demonstrating feature importance methods. This synthetic regression
task has a known ground truth:</p>
<ul>
<li>
<strong>5 important features</strong> (<code>important1</code> to
<code>important5</code>) that actually affect the target</li>
<li>
<strong>5 unimportant features</strong> (<code>unimportant1</code>
to <code>unimportant5</code>) that are pure noise</li>
</ul>
<p>The target function is: <span class="math inline">\(y = 10 *
\operatorname{sin}(\pi * x_1 * x_2) + 20 * (x_3 - 0.5)^2 + 10 * x_4 + 5
* x_5 + \epsilon\)</span></p>
<p>This makes it easy to evaluate whether our importance methods
correctly identify the truly important features.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Generate the task</span></span>
<span><span class="va">task</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html" class="external-link">tgen</a></span><span class="op">(</span><span class="st">"friedman1"</span><span class="op">)</span><span class="op">$</span><span class="fu">generate</span><span class="op">(</span>n <span class="op">=</span> <span class="fl">400</span><span class="op">)</span></span>
<span><span class="va">learner</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html" class="external-link">lrn</a></span><span class="op">(</span><span class="st">"regr.ranger"</span>, num.trees <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span>
<span><span class="va">resampling</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html" class="external-link">rsmp</a></span><span class="op">(</span><span class="st">"cv"</span>, folds <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="va">measure</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html" class="external-link">msr</a></span><span class="op">(</span><span class="st">"regr.mse"</span><span class="op">)</span></span></code></pre></div>
<p>The task has 400 observations with 10 features: important1,
important2, important3, important4, important5, unimportant1,
unimportant2, unimportant3, unimportant4, unimportant5. The target
variable is y.</p>
</div>
<div class="section level2">
<h2 id="permutation-feature-importance-pfi">Permutation Feature Importance (PFI)<a class="anchor" aria-label="anchor" href="#permutation-feature-importance-pfi"></a>
</h2>
<p>PFI shuffles each feature independently, breaking the association
between the feature and the target while preserving the marginal
distribution.</p>
<p>For more stable results, we use:</p>
<ul>
<li>3-fold CV for more reliable performance estimates</li>
<li>Within each resampling iteration, we repeat the
permutation-prediction-scoring step <code>iters_perm</code> times</li>
</ul>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pfi</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/PFI.html">PFI</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>  task <span class="op">=</span> <span class="va">task</span>,</span>
<span>  learner <span class="op">=</span> <span class="va">learner</span>,</span>
<span>  measure <span class="op">=</span> <span class="va">measure</span>,</span>
<span>  resampling <span class="op">=</span> <span class="va">resampling</span>,</span>
<span>  iters_perm <span class="op">=</span> <span class="fl">5</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Compute importance scores</span></span>
<span><span class="va">pfi_results</span> <span class="op">&lt;-</span> <span class="va">pfi</span><span class="op">$</span><span class="fu">compute</span><span class="op">(</span>relation <span class="op">=</span> <span class="st">"difference"</span><span class="op">)</span></span>
<span><span class="va">pfi_results</span></span>
<span><span class="co">#&gt; Key: &lt;feature&gt;</span></span>
<span><span class="co">#&gt;          feature  importance         sd</span></span>
<span><span class="co">#&gt;           &lt;char&gt;       &lt;num&gt;      &lt;num&gt;</span></span>
<span><span class="co">#&gt;  1:   important1  5.86554439 0.59082615</span></span>
<span><span class="co">#&gt;  2:   important2  7.53042540 1.18889134</span></span>
<span><span class="co">#&gt;  3:   important3  0.62852245 0.19171506</span></span>
<span><span class="co">#&gt;  4:   important4 12.07781769 2.05173137</span></span>
<span><span class="co">#&gt;  5:   important5  1.42191247 0.58343346</span></span>
<span><span class="co">#&gt;  6: unimportant1  0.03241761 0.07411001</span></span>
<span><span class="co">#&gt;  7: unimportant2  0.06147252 0.08463275</span></span>
<span><span class="co">#&gt;  8: unimportant3 -0.04262232 0.07889375</span></span>
<span><span class="co">#&gt;  9: unimportant4  0.07622793 0.07243864</span></span>
<span><span class="co">#&gt; 10: unimportant5 -0.01541102 0.08219456</span></span>
<span></span>
<span><span class="co"># Also stored in</span></span>
<span><span class="va">pfi</span><span class="op">$</span><span class="va">importance</span></span>
<span><span class="co">#&gt; Key: &lt;feature&gt;</span></span>
<span><span class="co">#&gt;          feature  importance         sd</span></span>
<span><span class="co">#&gt;           &lt;char&gt;       &lt;num&gt;      &lt;num&gt;</span></span>
<span><span class="co">#&gt;  1:   important1  5.86554439 0.59082615</span></span>
<span><span class="co">#&gt;  2:   important2  7.53042540 1.18889134</span></span>
<span><span class="co">#&gt;  3:   important3  0.62852245 0.19171506</span></span>
<span><span class="co">#&gt;  4:   important4 12.07781769 2.05173137</span></span>
<span><span class="co">#&gt;  5:   important5  1.42191247 0.58343346</span></span>
<span><span class="co">#&gt;  6: unimportant1  0.03241761 0.07411001</span></span>
<span><span class="co">#&gt;  7: unimportant2  0.06147252 0.08463275</span></span>
<span><span class="co">#&gt;  8: unimportant3 -0.04262232 0.07889375</span></span>
<span><span class="co">#&gt;  9: unimportant4  0.07622793 0.07243864</span></span>
<span><span class="co">#&gt; 10: unimportant5 -0.01541102 0.08219456</span></span>
<span></span>
<span><span class="co"># Show a sample of detailed scores</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">pfi</span><span class="op">$</span><span class="va">scores</span>, <span class="fl">10</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span>digits <span class="op">=</span> <span class="fl">4</span>, caption <span class="op">=</span> <span class="st">"Sample of PFI detailed scores"</span><span class="op">)</span></span></code></pre></div>
<table style="width:100%;" class="table">
<caption>Sample of PFI detailed scores</caption>
<colgroup>
<col width="15%">
<col width="14%">
<col width="14%">
<col width="20%">
<col width="20%">
<col width="15%">
</colgroup>
<thead><tr class="header">
<th align="left">feature</th>
<th align="right">iter_rsmp</th>
<th align="right">iter_perm</th>
<th align="right">regr.mse_orig</th>
<th align="right">regr.mse_perm</th>
<th align="right">importance</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">important1</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">7.2702</td>
<td align="right">12.8889</td>
<td align="right">5.6187</td>
</tr>
<tr class="even">
<td align="left">important1</td>
<td align="right">1</td>
<td align="right">2</td>
<td align="right">7.2702</td>
<td align="right">12.9852</td>
<td align="right">5.7150</td>
</tr>
<tr class="odd">
<td align="left">important1</td>
<td align="right">1</td>
<td align="right">3</td>
<td align="right">7.2702</td>
<td align="right">12.8721</td>
<td align="right">5.6019</td>
</tr>
<tr class="even">
<td align="left">important1</td>
<td align="right">1</td>
<td align="right">4</td>
<td align="right">7.2702</td>
<td align="right">13.3088</td>
<td align="right">6.0386</td>
</tr>
<tr class="odd">
<td align="left">important1</td>
<td align="right">1</td>
<td align="right">5</td>
<td align="right">7.2702</td>
<td align="right">13.8732</td>
<td align="right">6.6030</td>
</tr>
<tr class="even">
<td align="left">important1</td>
<td align="right">2</td>
<td align="right">1</td>
<td align="right">6.5886</td>
<td align="right">12.4538</td>
<td align="right">5.8652</td>
</tr>
<tr class="odd">
<td align="left">important1</td>
<td align="right">2</td>
<td align="right">2</td>
<td align="right">6.5886</td>
<td align="right">12.5989</td>
<td align="right">6.0103</td>
</tr>
<tr class="even">
<td align="left">important1</td>
<td align="right">2</td>
<td align="right">3</td>
<td align="right">6.5886</td>
<td align="right">13.0967</td>
<td align="right">6.5081</td>
</tr>
<tr class="odd">
<td align="left">important1</td>
<td align="right">2</td>
<td align="right">4</td>
<td align="right">6.5886</td>
<td align="right">12.4237</td>
<td align="right">5.8351</td>
</tr>
<tr class="even">
<td align="left">important1</td>
<td align="right">2</td>
<td align="right">5</td>
<td align="right">6.5886</td>
<td align="right">12.5381</td>
<td align="right">5.9495</td>
</tr>
</tbody>
</table>
</div>
<div class="section level2">
<h2 id="conditional-feature-importance-cfi">Conditional Feature Importance (CFI)<a class="anchor" aria-label="anchor" href="#conditional-feature-importance-cfi"></a>
</h2>
<p>CFI uses conditional sampling to preserve the joint distribution of
all other features when perturbing a feature of interest. By default we
use Adversarial Random Forests (ARF) as conditional sampler
internally.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sampler</span> <span class="op">=</span> <span class="va"><a href="../reference/ARFSampler.html">ARFSampler</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>  task <span class="op">=</span> <span class="va">task</span>, </span>
<span>  arf_args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>,</span>
<span>  forde_args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Example sampling for 5 randomly chosen rows from the task</span></span>
<span><span class="va">sample_data</span> <span class="op">&lt;-</span> <span class="va">task</span><span class="op">$</span><span class="fu">data</span><span class="op">(</span>rows <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">task</span><span class="op">$</span><span class="va">nrow</span>, size <span class="op">=</span> <span class="fl">5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">sampled_result</span> <span class="op">&lt;-</span> <span class="va">sampler</span><span class="op">$</span><span class="fu">sample</span><span class="op">(</span></span>
<span>  feature <span class="op">=</span> <span class="st">"important1"</span>, </span>
<span>  data <span class="op">=</span> <span class="va">sample_data</span>, </span>
<span>  conditioning_features <span class="op">=</span> <span class="st">"important2"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Original <code>important1</code> values: 0.246, 0.786, 0.492, 0.668,
0.521</p>
<p>Sampled <code>important1</code> values (conditioned on
<code>important2</code>): -0.152, 0.829, 0.16, 0.756, 0.74</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cfi</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/CFI.html">CFI</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>  task <span class="op">=</span> <span class="va">task</span>,</span>
<span>  learner <span class="op">=</span> <span class="va">learner</span>,</span>
<span>  measure <span class="op">=</span> <span class="va">measure</span>,</span>
<span>  resampling <span class="op">=</span> <span class="va">resampling</span>,</span>
<span>  iters_perm <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  sampler <span class="op">=</span> <span class="va">sampler</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Compute importance scores</span></span>
<span><span class="va">cfi_results</span> <span class="op">&lt;-</span> <span class="va">cfi</span><span class="op">$</span><span class="fu">compute</span><span class="op">(</span>relation <span class="op">=</span> <span class="st">"difference"</span><span class="op">)</span></span>
<span><span class="va">cfi_results</span></span>
<span><span class="co">#&gt; Key: &lt;feature&gt;</span></span>
<span><span class="co">#&gt;          feature   importance         sd</span></span>
<span><span class="co">#&gt;           &lt;char&gt;        &lt;num&gt;      &lt;num&gt;</span></span>
<span><span class="co">#&gt;  1:   important1  3.174003832 0.71919051</span></span>
<span><span class="co">#&gt;  2:   important2  3.435560781 0.63674319</span></span>
<span><span class="co">#&gt;  3:   important3  0.487036933 0.20581981</span></span>
<span><span class="co">#&gt;  4:   important4  4.345208881 0.73990098</span></span>
<span><span class="co">#&gt;  5:   important5  0.551741678 0.27226931</span></span>
<span><span class="co">#&gt;  6: unimportant1  0.040457097 0.05467298</span></span>
<span><span class="co">#&gt;  7: unimportant2  0.055751318 0.08539057</span></span>
<span><span class="co">#&gt;  8: unimportant3 -0.036216862 0.05459353</span></span>
<span><span class="co">#&gt;  9: unimportant4  0.051101874 0.05396739</span></span>
<span><span class="co">#&gt; 10: unimportant5 -0.008660248 0.07443565</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="relative-feature-importance-rfi">Relative Feature Importance (RFI)<a class="anchor" aria-label="anchor" href="#relative-feature-importance-rfi"></a>
</h2>
<p>RFI conditions on a specific subset of features, measuring importance
relative to those features. Let’s condition on two of the important
features to see how the others rank relative to this baseline.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">conditioning_set</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"important1"</span>, <span class="st">"important2"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">rfi</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/RFI.html">RFI</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>  task <span class="op">=</span> <span class="va">task</span>,</span>
<span>  learner <span class="op">=</span> <span class="va">learner</span>,</span>
<span>  measure <span class="op">=</span> <span class="va">measure</span>,</span>
<span>  resampling <span class="op">=</span> <span class="va">resampling</span>,</span>
<span>  conditioning_set <span class="op">=</span> <span class="va">conditioning_set</span>,</span>
<span>  iters_perm <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  sampler <span class="op">=</span> <span class="va">sampler</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Compute importance scores</span></span>
<span><span class="va">rfi_results</span> <span class="op">&lt;-</span> <span class="va">rfi</span><span class="op">$</span><span class="fu">compute</span><span class="op">(</span>relation <span class="op">=</span> <span class="st">"difference"</span><span class="op">)</span></span>
<span><span class="va">rfi_results</span></span>
<span><span class="co">#&gt; Key: &lt;feature&gt;</span></span>
<span><span class="co">#&gt;          feature   importance         sd</span></span>
<span><span class="co">#&gt;           &lt;char&gt;        &lt;num&gt;      &lt;num&gt;</span></span>
<span><span class="co">#&gt;  1:   important1  0.000000000 0.00000000</span></span>
<span><span class="co">#&gt;  2:   important2  0.000000000 0.00000000</span></span>
<span><span class="co">#&gt;  3:   important3  0.659032969 0.16358207</span></span>
<span><span class="co">#&gt;  4:   important4 11.168278482 1.03079984</span></span>
<span><span class="co">#&gt;  5:   important5  1.391927039 0.30919359</span></span>
<span><span class="co">#&gt;  6: unimportant1  0.035829586 0.09673696</span></span>
<span><span class="co">#&gt;  7: unimportant2  0.111951122 0.11040894</span></span>
<span><span class="co">#&gt;  8: unimportant3 -0.003414726 0.11705205</span></span>
<span><span class="co">#&gt;  9: unimportant4  0.063271393 0.07071163</span></span>
<span><span class="co">#&gt; 10: unimportant5  0.022609332 0.06713596</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="comparing-methods">Comparing Methods<a class="anchor" aria-label="anchor" href="#comparing-methods"></a>
</h2>
<p>Now let’s compare the results from all three methods:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Combine results for comparison</span></span>
<span><span class="va">comparison</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span></span>
<span>  <span class="va">pfi_results</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span><span class="va">feature</span>, pfi <span class="op">=</span> <span class="va">importance</span><span class="op">)</span><span class="op">]</span>,</span>
<span>  <span class="va">cfi_results</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span><span class="va">feature</span>, cfi <span class="op">=</span> <span class="va">importance</span><span class="op">)</span><span class="op">]</span>,</span>
<span>  by <span class="op">=</span> <span class="st">"feature"</span></span>
<span><span class="op">)</span></span>
<span><span class="va">comparison</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span></span>
<span>  <span class="va">comparison</span>,</span>
<span>  <span class="va">rfi_results</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span><span class="va">feature</span>, rfi <span class="op">=</span> <span class="va">importance</span><span class="op">)</span><span class="op">]</span>,</span>
<span>  by <span class="op">=</span> <span class="st">"feature"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Add feature type for analysis</span></span>
<span><span class="va">comparison</span><span class="op">[</span>, <span class="va">feature_type</span> <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"^important"</span>, <span class="va">feature</span><span class="op">)</span>, <span class="st">"Important"</span>, <span class="st">"Noise"</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="va">comparison</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span></span>
<span>    digits <span class="op">=</span> <span class="fl">4</span>, </span>
<span>    caption <span class="op">=</span> <span class="st">"Feature Importance Comparison (Difference Scores)"</span>,</span>
<span>    col.names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Feature"</span>, <span class="st">"PFI"</span>, <span class="st">"CFI"</span>, <span class="st">"RFI"</span>, <span class="st">"Type"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<table class="table">
<caption>Feature Importance Comparison (Difference Scores)</caption>
<thead><tr class="header">
<th align="left">Feature</th>
<th align="right">PFI</th>
<th align="right">CFI</th>
<th align="right">RFI</th>
<th align="left">Type</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">important1</td>
<td align="right">5.8655</td>
<td align="right">3.1740</td>
<td align="right">0.0000</td>
<td align="left">Important</td>
</tr>
<tr class="even">
<td align="left">important2</td>
<td align="right">7.5304</td>
<td align="right">3.4356</td>
<td align="right">0.0000</td>
<td align="left">Important</td>
</tr>
<tr class="odd">
<td align="left">important3</td>
<td align="right">0.6285</td>
<td align="right">0.4870</td>
<td align="right">0.6590</td>
<td align="left">Important</td>
</tr>
<tr class="even">
<td align="left">important4</td>
<td align="right">12.0778</td>
<td align="right">4.3452</td>
<td align="right">11.1683</td>
<td align="left">Important</td>
</tr>
<tr class="odd">
<td align="left">important5</td>
<td align="right">1.4219</td>
<td align="right">0.5517</td>
<td align="right">1.3919</td>
<td align="left">Important</td>
</tr>
<tr class="even">
<td align="left">unimportant1</td>
<td align="right">0.0324</td>
<td align="right">0.0405</td>
<td align="right">0.0358</td>
<td align="left">Noise</td>
</tr>
<tr class="odd">
<td align="left">unimportant2</td>
<td align="right">0.0615</td>
<td align="right">0.0558</td>
<td align="right">0.1120</td>
<td align="left">Noise</td>
</tr>
<tr class="even">
<td align="left">unimportant3</td>
<td align="right">-0.0426</td>
<td align="right">-0.0362</td>
<td align="right">-0.0034</td>
<td align="left">Noise</td>
</tr>
<tr class="odd">
<td align="left">unimportant4</td>
<td align="right">0.0762</td>
<td align="right">0.0511</td>
<td align="right">0.0633</td>
<td align="left">Noise</td>
</tr>
<tr class="even">
<td align="left">unimportant5</td>
<td align="right">-0.0154</td>
<td align="right">-0.0087</td>
<td align="right">0.0226</td>
<td align="left">Noise</td>
</tr>
</tbody>
</table>
</div>
<div class="section level2">
<h2 id="visualization">Visualization<a class="anchor" aria-label="anchor" href="#visualization"></a>
</h2>
<p>Let’s create comprehensive visualizations to understand the
results:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Reshape data for plotting</span></span>
<span><span class="va">plot_data</span> <span class="op">&lt;-</span> <span class="va">comparison</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/melt.data.table.html" class="external-link">melt</a></span><span class="op">(</span></span>
<span>    id.vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"feature"</span>, <span class="st">"feature_type"</span><span class="op">)</span>,</span>
<span>    measure.vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"pfi"</span>, <span class="st">"cfi"</span>, <span class="st">"rfi"</span><span class="op">)</span>,</span>
<span>    value.name <span class="op">=</span> <span class="st">"importance"</span>,</span>
<span>    variable.name <span class="op">=</span> <span class="st">"method"</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># Clean up method names</span></span>
<span><span class="va">plot_data</span><span class="op">[</span>, <span class="va">method</span> <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/r/base/chartr.html" class="external-link">toupper</a></span><span class="op">(</span><span class="va">method</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Create the comparison plot</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">plot_data</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">importance</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/reorder.factor.html" class="external-link">reorder</a></span><span class="op">(</span><span class="va">feature</span>, <span class="va">importance</span><span class="op">)</span>, fill <span class="op">=</span> <span class="va">method</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">feature_type</span>, scales <span class="op">=</span> <span class="st">"free_y"</span>, ncol <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_col</a></span><span class="op">(</span>position <span class="op">=</span> <span class="st">"dodge"</span>, alpha <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"PFI"</span> <span class="op">=</span> <span class="st">"steelblue"</span>, <span class="st">"CFI"</span> <span class="op">=</span> <span class="st">"darkgreen"</span>, <span class="st">"RFI"</span> <span class="op">=</span> <span class="st">"orange"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Feature Importance Comparison: PFI vs CFI vs RFI"</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="fu">glue</span><span class="fu">::</span><span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html" class="external-link">glue</a></span><span class="op">(</span><span class="st">"Friedman1 task: 5 important + 5 noise features</span></span>
<span><span class="st">                          RFI conditioned on: {paste(conditioning_set, collapse = ', ')}"</span><span class="op">)</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"Importance Score (Difference)"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Feature"</span>,</span>
<span>    fill <span class="op">=</span> <span class="st">"Method"</span>,</span>
<span>    caption <span class="op">=</span> <span class="fu">glue</span><span class="fu">::</span><span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html" class="external-link">glue</a></span><span class="op">(</span><span class="st">"Using {resampling$iters}-fold cross-validation</span></span>
<span><span class="st">                          and 5 permutation iterations"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">14</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span></span>
<span>    legend.position <span class="op">=</span> <span class="st">"bottom"</span>,</span>
<span>    plot.title.position <span class="op">=</span> <span class="st">"plot"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><img src="perturbation-importance_files/figure-html/visualization-comparison-1.png" width="768"></p>
<p>Let’s also create a correlation plot to see how similar the methods
are:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Calculate correlations between methods</span></span>
<span><span class="va">pfi_cfi_cor</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span><span class="va">comparison</span><span class="op">$</span><span class="va">pfi</span>, <span class="va">comparison</span><span class="op">$</span><span class="va">cfi</span><span class="op">)</span></span>
<span><span class="va">pfi_rfi_cor</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span><span class="va">comparison</span><span class="op">$</span><span class="va">pfi</span>, <span class="va">comparison</span><span class="op">$</span><span class="va">rfi</span><span class="op">)</span></span>
<span><span class="va">cfi_rfi_cor</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span><span class="va">comparison</span><span class="op">$</span><span class="va">cfi</span>, <span class="va">comparison</span><span class="op">$</span><span class="va">rfi</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create correlation matrix plot</span></span>
<span><span class="va">cor_data</span> <span class="op">&lt;-</span> <span class="va">comparison</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span><span class="va">feature</span>, <span class="va">pfi</span>, <span class="va">cfi</span>, <span class="va">rfi</span>, <span class="va">feature_type</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># PFI vs CFI</span></span>
<span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">cor_data</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">pfi</span>, y <span class="op">=</span> <span class="va">cfi</span>, color <span class="op">=</span> <span class="va">feature_type</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">3</span>, alpha <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html" class="external-link">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"lm"</span>, se <span class="op">=</span> <span class="cn">FALSE</span>, color <span class="op">=</span> <span class="st">"gray50"</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Important"</span> <span class="op">=</span> <span class="st">"steelblue"</span>, <span class="st">"Noise"</span> <span class="op">=</span> <span class="st">"lightcoral"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"PFI vs CFI"</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"Correlation: %.3f"</span>, <span class="va">pfi_cfi_cor</span><span class="op">)</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"PFI Score"</span>, y <span class="op">=</span> <span class="st">"CFI Score"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">14</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># PFI vs RFI  </span></span>
<span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">cor_data</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">pfi</span>, y <span class="op">=</span> <span class="va">rfi</span>, color <span class="op">=</span> <span class="va">feature_type</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">3</span>, alpha <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html" class="external-link">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"lm"</span>, se <span class="op">=</span> <span class="cn">FALSE</span>, color <span class="op">=</span> <span class="st">"gray50"</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Important"</span> <span class="op">=</span> <span class="st">"steelblue"</span>, <span class="st">"Noise"</span> <span class="op">=</span> <span class="st">"lightcoral"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"PFI vs RFI"</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"Correlation: %.3f"</span>, <span class="va">pfi_rfi_cor</span><span class="op">)</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"PFI Score"</span>, y <span class="op">=</span> <span class="st">"RFI Score"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">14</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># CFI vs RFI</span></span>
<span><span class="va">p3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">cor_data</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">cfi</span>, y <span class="op">=</span> <span class="va">rfi</span>, color <span class="op">=</span> <span class="va">feature_type</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">3</span>, alpha <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html" class="external-link">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"lm"</span>, se <span class="op">=</span> <span class="cn">FALSE</span>, color <span class="op">=</span> <span class="st">"gray50"</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span></span>
<span>    values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Important"</span> <span class="op">=</span> <span class="st">"steelblue"</span>, <span class="st">"Noise"</span> <span class="op">=</span> <span class="st">"lightcoral"</span><span class="op">)</span>,</span>
<span>    name <span class="op">=</span> <span class="st">"Feature Type"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"CFI vs RFI"</span>, </span>
<span>    subtitle <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"Correlation: %.3f"</span>, <span class="va">cfi_rfi_cor</span><span class="op">)</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"CFI Score"</span>, y <span class="op">=</span> <span class="st">"RFI Score"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">14</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Combine plots</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com" class="external-link">patchwork</a></span><span class="op">)</span></span>
<span><span class="op">(</span><span class="va">p1</span> <span class="op">/</span> <span class="va">p2</span> <span class="op">/</span> <span class="va">p3</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://patchwork.data-imaginist.com/reference/plot_annotation.html" class="external-link">plot_annotation</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Method Correlations"</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="st">"Each point represents one feature"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span></span>
<span><span class="co">#&gt; `geom_smooth()` using formula = 'y ~ x'</span></span>
<span><span class="co">#&gt; `geom_smooth()` using formula = 'y ~ x'</span></span>
<span><span class="co">#&gt; `geom_smooth()` using formula = 'y ~ x'</span></span></code></pre></div>
<p><img src="perturbation-importance_files/figure-html/correlation-analysis-1.png" width="768"></p>
</div>
<div class="section level2">
<h2 id="understanding-the-results">Understanding the Results<a class="anchor" aria-label="anchor" href="#understanding-the-results"></a>
</h2>
<p>Let’s analyze how well each method distinguishes important from noise
features:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Calculate summary statistics by feature type</span></span>
<span><span class="va">summary_stats</span> <span class="op">&lt;-</span> <span class="va">comparison</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span></span>
<span>  mean_importance <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">pfi</span>, <span class="va">cfi</span>, <span class="va">rfi</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  pfi_mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">pfi</span><span class="op">)</span>,</span>
<span>  cfi_mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">cfi</span><span class="op">)</span>, </span>
<span>  rfi_mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">rfi</span><span class="op">)</span>,</span>
<span>  n_features <span class="op">=</span> <span class="va">.N</span></span>
<span><span class="op">)</span>, by <span class="op">=</span> <span class="va">feature_type</span><span class="op">]</span></span>
<span></span>
<span><span class="va">summary_stats</span> <span class="op">|&gt;</span> <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span>digits <span class="op">=</span> <span class="fl">4</span>, caption <span class="op">=</span> <span class="st">"Summary by feature type"</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<caption>Summary by feature type</caption>
<colgroup>
<col width="19%">
<col width="23%">
<col width="13%">
<col width="13%">
<col width="13%">
<col width="16%">
</colgroup>
<thead><tr class="header">
<th align="left">feature_type</th>
<th align="right">mean_importance</th>
<th align="right">pfi_mean</th>
<th align="right">cfi_mean</th>
<th align="right">rfi_mean</th>
<th align="right">n_features</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Important</td>
<td align="right">3.5158</td>
<td align="right">5.5048</td>
<td align="right">2.3987</td>
<td align="right">2.6438</td>
<td align="right">5</td>
</tr>
<tr class="even">
<td align="left">Noise</td>
<td align="right">0.0297</td>
<td align="right">0.0224</td>
<td align="right">0.0205</td>
<td align="right">0.0460</td>
<td align="right">5</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Calculate separation ratios (how well each method separates signal from noise)</span></span>
<span><span class="va">important_pfi</span> <span class="op">&lt;-</span> <span class="va">comparison</span><span class="op">[</span><span class="va">feature_type</span> <span class="op">==</span> <span class="st">"Important"</span>, <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">pfi</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">noise_pfi</span> <span class="op">&lt;-</span> <span class="va">comparison</span><span class="op">[</span><span class="va">feature_type</span> <span class="op">==</span> <span class="st">"Noise"</span>, <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">pfi</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">pfi_separation</span> <span class="op">&lt;-</span> <span class="va">important_pfi</span> <span class="op">/</span> <span class="va">noise_pfi</span></span>
<span></span>
<span><span class="va">important_cfi</span> <span class="op">&lt;-</span> <span class="va">comparison</span><span class="op">[</span><span class="va">feature_type</span> <span class="op">==</span> <span class="st">"Important"</span>, <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">cfi</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">noise_cfi</span> <span class="op">&lt;-</span> <span class="va">comparison</span><span class="op">[</span><span class="va">feature_type</span> <span class="op">==</span> <span class="st">"Noise"</span>, <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">cfi</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">cfi_separation</span> <span class="op">&lt;-</span> <span class="va">important_cfi</span> <span class="op">/</span> <span class="va">noise_cfi</span></span>
<span></span>
<span><span class="va">important_rfi</span> <span class="op">&lt;-</span> <span class="va">comparison</span><span class="op">[</span><span class="va">feature_type</span> <span class="op">==</span> <span class="st">"Important"</span>, <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">rfi</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">noise_rfi</span> <span class="op">&lt;-</span> <span class="va">comparison</span><span class="op">[</span><span class="va">feature_type</span> <span class="op">==</span> <span class="st">"Noise"</span>, <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">rfi</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">rfi_separation</span> <span class="op">&lt;-</span> <span class="va">important_rfi</span> <span class="op">/</span> <span class="va">noise_rfi</span></span>
<span></span>
<span><span class="co"># Store results for inline reporting</span></span>
<span><span class="va">pfi_sep</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">pfi_separation</span>, <span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">cfi_sep</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">cfi_separation</span>, <span class="fl">2</span><span class="op">)</span> </span>
<span><span class="va">rfi_sep</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">rfi_separation</span>, <span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">pfi_cfi</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">pfi_cfi_cor</span>, <span class="fl">3</span><span class="op">)</span></span>
<span><span class="va">pfi_rfi</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">pfi_rfi_cor</span>, <span class="fl">3</span><span class="op">)</span></span>
<span><span class="va">cfi_rfi</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">cfi_rfi_cor</span>, <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="method-performance">Method Performance<a class="anchor" aria-label="anchor" href="#method-performance"></a>
</h3>
<p><strong>Separation ratios</strong> (how well each method
distinguishes important from noise features): - PFI: 120.64 - CFI:
62.41<br>
- RFI: 55.76</p>
<p><strong>Correlations between methods:</strong> - PFI vs CFI: 0.98 -
PFI vs RFI: 0.751 - CFI vs RFI: 0.619</p>
</div>
</div>
<div class="section level2">
<h2 id="understanding-the-differences">Understanding the Differences<a class="anchor" aria-label="anchor" href="#understanding-the-differences"></a>
</h2>
<p>The three methods can yield different results because they make
different assumptions:</p>
<ol style="list-style-type: decimal">
<li><p><strong>PFI</strong> assumes features are independent and
measures the marginal importance of each feature.</p></li>
<li><p><strong>CFI</strong> preserves the conditional distribution <span class="math inline">\(P(X_{-j} | X_j)\)</span> when perturbing feature
<span class="math inline">\(j\)</span>, providing a more realistic
assessment when features are correlated.</p></li>
<li><p><strong>RFI</strong> measures importance relative to a specific
conditioning set, answering “what additional information does this
feature provide beyond what we already know from the conditioning
features?”</p></li>
</ol>
<p>In our Friedman1 example:</p>
<ul>
<li>All methods successfully identify that <code>important1</code>
through <code>important5</code> are more important than
<code>unimportant1</code> through <code>unimportant5</code>
</li>
<li>The relative rankings may differ because:
<ul>
<li>PFI treats each feature in isolation</li>
<li>CFI accounts for dependencies between all features</li>
<li>RFI shows which features add value beyond <code>important1</code>
and <code>important2</code>
</li>
</ul>
</li>
</ul>
</div>
<div class="section level2">
<h2 id="variability-analysis">Variability Analysis<a class="anchor" aria-label="anchor" href="#variability-analysis"></a>
</h2>
<p>Let’s examine the stability of our importance estimates across
resampling- and permutation iterations using the <code>$scores</code>
tables:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">detailed_scores</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/rbindlist.html" class="external-link">rbindlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="va">pfi</span><span class="op">$</span><span class="va">scores</span><span class="op">[</span>, <span class="va">method</span> <span class="op">:=</span> <span class="st">"PFI"</span><span class="op">]</span>,</span>
<span>  <span class="va">cfi</span><span class="op">$</span><span class="va">scores</span><span class="op">[</span>, <span class="va">method</span> <span class="op">:=</span> <span class="st">"CFI"</span><span class="op">]</span>,</span>
<span>  <span class="va">rfi</span><span class="op">$</span><span class="va">scores</span><span class="op">[</span>, <span class="va">method</span> <span class="op">:=</span> <span class="st">"RFI"</span><span class="op">]</span></span>
<span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">score_summary</span> <span class="op">&lt;-</span> <span class="va">detailed_scores</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span></span>
<span>  mean_importance <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">importance</span><span class="op">)</span>,</span>
<span>  sd_importance <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">importance</span><span class="op">)</span>,</span>
<span>  n_iterations <span class="op">=</span> <span class="va">.N</span></span>
<span><span class="op">)</span>, by <span class="op">=</span> <span class="fu">.</span><span class="op">(</span><span class="va">feature</span>, <span class="va">method</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Add feature type</span></span>
<span><span class="va">score_summary</span><span class="op">[</span>, <span class="va">feature_type</span> <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"^important"</span>, <span class="va">feature</span><span class="op">)</span>, <span class="st">"Important"</span>, <span class="st">"Noise"</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Plot error bars</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">score_summary</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span></span>
<span>    y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/reorder.factor.html" class="external-link">reorder</a></span><span class="op">(</span><span class="va">feature</span>, <span class="va">mean_importance</span><span class="op">)</span>, </span>
<span>    x <span class="op">=</span> <span class="va">mean_importance</span>,</span>
<span>    xmin <span class="op">=</span> <span class="va">mean_importance</span> <span class="op">-</span> <span class="va">sd_importance</span>, </span>
<span>    xmax <span class="op">=</span> <span class="va">mean_importance</span> <span class="op">+</span> <span class="va">sd_importance</span>,</span>
<span>    color <span class="op">=</span> <span class="va">method</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">feature_type</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">1</span>, scales <span class="op">=</span> <span class="st">"free_y"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_errorbarh.html" class="external-link">geom_errorbarh</a></span><span class="op">(</span>linewidth <span class="op">=</span> <span class="fl">1</span>, height <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_color_brewer</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Dark2"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Importance Score Variability: Mean ± SD"</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="fu">glue</span><span class="fu">::</span><span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html" class="external-link">glue</a></span><span class="op">(</span><span class="st">"Error bars show standard deviation across iterations</span></span>
<span><span class="st">                      RFI conditioned on: {paste(conditioning_set, collapse = ', ')}"</span><span class="op">)</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"Score (Difference)"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Feature"</span>,</span>
<span>    color <span class="op">=</span> <span class="st">"Method"</span>,</span>
<span>    caption <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Using"</span>, <span class="va">resampling</span><span class="op">$</span><span class="va">iters</span>, <span class="st">"-fold CV and"</span>, <span class="va">pfi</span><span class="op">$</span><span class="va">param_set</span><span class="op">$</span><span class="va">values</span><span class="op">$</span><span class="va">iters_perm</span>, <span class="st">"permutations each"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">14</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span></span>
<span>    plot.title.position <span class="op">=</span> <span class="st">"plot"</span>,</span>
<span>    legend.position <span class="op">=</span> <span class="st">"bottom"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><img src="perturbation-importance_files/figure-html/variability-analysis-1.png" width="768"></p>
</div>
<div class="section level2">
<h2 id="advanced-usage">Advanced Usage<a class="anchor" aria-label="anchor" href="#advanced-usage"></a>
</h2>
<div class="section level3">
<h3 id="custom-samplers">Custom Samplers<a class="anchor" aria-label="anchor" href="#custom-samplers"></a>
</h3>
<p>You can provide custom samplers for more control:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create a custom ARF sampler with specific parameters</span></span>
<span><span class="va">custom_sampler</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/ARFSampler.html">ARFSampler</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>  task <span class="op">=</span> <span class="va">task</span>,</span>
<span>  arf_args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>num.trees <span class="op">=</span> <span class="fl">50</span><span class="op">)</span>,  <span class="co"># Fewer trees for faster computation</span></span>
<span>  forde_args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>finite_bounds <span class="op">=</span> <span class="st">"no"</span><span class="op">)</span> <span class="co"># Allow extrapolation</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">cfi_custom</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/CFI.html">CFI</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>  task <span class="op">=</span> <span class="va">task</span>,</span>
<span>  learner <span class="op">=</span> <span class="va">learner</span>,</span>
<span>  measure <span class="op">=</span> <span class="va">measure</span>,</span>
<span>  resampling <span class="op">=</span> <span class="va">resampling</span>,</span>
<span>  sampler <span class="op">=</span> <span class="va">custom_sampler</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="empty-conditioning-set-for-rfi">Empty Conditioning Set for RFI<a class="anchor" aria-label="anchor" href="#empty-conditioning-set-for-rfi"></a>
</h3>
<p>RFI with an empty conditioning set should produce similar results to
PFI:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rfi_empty</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/RFI.html">RFI</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>  task <span class="op">=</span> <span class="va">task</span>,</span>
<span>  learner <span class="op">=</span> <span class="va">learner</span>,</span>
<span>  measure <span class="op">=</span> <span class="va">measure</span>,</span>
<span>  resampling <span class="op">=</span> <span class="va">resampling</span>,</span>
<span>  conditioning_set <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">character</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span>, <span class="co"># Empty conditioning set</span></span>
<span>  iters_perm <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  sampler <span class="op">=</span> <span class="va">sampler</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">rfi_empty_results</span> <span class="op">&lt;-</span> <span class="va">rfi_empty</span><span class="op">$</span><span class="fu">compute</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Compare with PFI</span></span>
<span><span class="va">empty_comparison</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span></span>
<span>  <span class="va">pfi_results</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span><span class="va">feature</span>, pfi <span class="op">=</span> <span class="va">importance</span><span class="op">)</span><span class="op">]</span>,</span>
<span>  <span class="va">rfi_empty_results</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span><span class="va">feature</span>, rfi_empty <span class="op">=</span> <span class="va">importance</span><span class="op">)</span><span class="op">]</span>,</span>
<span>  by <span class="op">=</span> <span class="st">"feature"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">correlation_empty</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span><span class="va">empty_comparison</span><span class="op">$</span><span class="va">pfi</span>, <span class="va">empty_comparison</span><span class="op">$</span><span class="va">rfi_empty</span><span class="op">)</span></span></code></pre></div>
<p>The correlation between PFI and RFI with empty conditioning set is
0.997, confirming that <span class="math inline">\(\mathrm{RFI}(\emptyset) \approx
\mathrm{PFI}\)</span> as expected.</p>
</div>
</div>
<div class="section level2">
<h2 id="key-takeaways">Key Takeaways<a class="anchor" aria-label="anchor" href="#key-takeaways"></a>
</h2>
<ol style="list-style-type: decimal">
<li>
<strong>All methods correctly identify important features</strong>
in this well-structured synthetic task</li>
<li>
<strong>PFI provides a baseline</strong> for marginal feature
importance</li>
<li>
<strong>CFI accounts for feature dependencies</strong> through
conditional sampling</li>
<li>
<strong>RFI measures relative importance</strong> beyond a specified
conditioning set</li>
<li>
<strong>Method choice depends on your question</strong>:
<ul>
<li>Use PFI for simple, interpretable marginal importance</li>
<li>Use CFI when feature dependencies matter</li>
<li>Use RFI to understand incremental value beyond known important
features</li>
</ul>
</li>
</ol>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://lukasburk.de" class="external-link">Lukas Burk</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
