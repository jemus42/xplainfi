<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Perturbation-based Feature Importance Methods • xplainfi</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Perturbation-based Feature Importance Methods">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">xplainfi</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/xplainfi.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/perturbation-importance.html">Perturbation-based Feature Importance Methods</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/jemus42/xplainfi/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Perturbation-based Feature Importance Methods</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/jemus42/xplainfi/blob/main/vignettes/perturbation-importance.Rmd" class="external-link"><code>vignettes/perturbation-importance.Rmd</code></a></small>
      <div class="d-none name"><code>perturbation-importance.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://jemus42.github.io/xplainfi/">xplainfi</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># learners, tasks, etc.</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mlr3.mlr-org.com" class="external-link">mlr3</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/mlr-org/mlr3data" class="external-link">mlr3data</a></span><span class="op">)</span> <span class="co"># penguins_simple</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mlr3learners.mlr-org.com" class="external-link">mlr3learners</a></span><span class="op">)</span> <span class="co"># ranger</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span></span></code></pre></div>
<p>This vignette demonstrates the three perturbation-based feature
importance methods implemented in xplainfi:</p>
<ul>
<li>
<strong>PFI (Permutation Feature Importance)</strong>: Uses marginal
sampling (simple permutation)</li>
<li>
<strong>CFI (Conditional Feature Importance)</strong>: Uses
conditional sampling via Adversarial Random Forests</li>
<li>
<strong>RFI (Relative Feature Importance)</strong>: Uses conditional
sampling on a user-specified subset of features</li>
</ul>
<div class="section level2">
<h2 id="problem-setup">Problem Setup<a class="anchor" aria-label="anchor" href="#problem-setup"></a>
</h2>
<p>We’ll use the <code>penguins_simple</code> dataset to compare these
methods:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">task</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html" class="external-link">tsk</a></span><span class="op">(</span><span class="st">"penguins"</span><span class="op">)</span></span>
<span><span class="va">learner</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html" class="external-link">lrn</a></span><span class="op">(</span><span class="st">"classif.ranger"</span>, num.trees <span class="op">=</span> <span class="fl">100</span>, num.threads <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">resampling</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html" class="external-link">rsmp</a></span><span class="op">(</span><span class="st">"cv"</span>, folds <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="va">measure</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html" class="external-link">msr</a></span><span class="op">(</span><span class="st">"classif.acc"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Show the task structure</span></span>
<span><span class="va">task</span></span>
<span><span class="co">#&gt; &lt;TaskClassif:penguins&gt; (344 x 8): Palmer Penguins</span></span>
<span><span class="co">#&gt; * Target: species</span></span>
<span><span class="co">#&gt; * Properties: multiclass</span></span>
<span><span class="co">#&gt; * Features (7):</span></span>
<span><span class="co">#&gt;   - int (3): body_mass, flipper_length, year</span></span>
<span><span class="co">#&gt;   - dbl (2): bill_depth, bill_length</span></span>
<span><span class="co">#&gt;   - fct (2): island, sex</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="permutation-feature-importance-pfi">Permutation Feature Importance (PFI)<a class="anchor" aria-label="anchor" href="#permutation-feature-importance-pfi"></a>
</h2>
<p>PFI shuffles each feature independently, breaking the association
between the feature and the target while preserving the marginal
distribution.</p>
<p>For more stable results, we</p>
<ul>
<li><ol style="list-style-type: lower-alpha">
<li>Use 3-fold CV for more reliable performance estimates</li>
</ol></li>
<li><ol start="2" style="list-style-type: lower-alpha">
<li>Within each resampling iteration, we repeat the
permutation-prediction-scoring step <code>iters_perm</code> times</li>
</ol></li>
</ul>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pfi</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/PFI.html">PFI</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>  task <span class="op">=</span> <span class="va">task</span>,</span>
<span>  learner <span class="op">=</span> <span class="va">learner</span>,</span>
<span>  measure <span class="op">=</span> <span class="va">measure</span>,</span>
<span>  resampling <span class="op">=</span> <span class="va">resampling</span>,</span>
<span>  iters_perm <span class="op">=</span> <span class="fl">5</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Compute importance scores</span></span>
<span><span class="va">pfi_results</span> <span class="op">&lt;-</span> <span class="va">pfi</span><span class="op">$</span><span class="fu">compute</span><span class="op">(</span>relation <span class="op">=</span> <span class="st">"difference"</span><span class="op">)</span></span>
<span><span class="va">pfi_results</span></span>
<span><span class="co">#&gt; Key: &lt;feature&gt;</span></span>
<span><span class="co">#&gt;           feature  importance</span></span>
<span><span class="co">#&gt;            &lt;char&gt;       &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1:     bill_depth 0.029077040</span></span>
<span><span class="co">#&gt; 2:    bill_length 0.259471142</span></span>
<span><span class="co">#&gt; 3:      body_mass 0.007002288</span></span>
<span><span class="co">#&gt; 4: flipper_length 0.012819730</span></span>
<span><span class="co">#&gt; 5:         island 0.027897279</span></span>
<span><span class="co">#&gt; 6:            sex 0.005252988</span></span>
<span><span class="co">#&gt; 7:           year 0.001764556</span></span>
<span></span>
<span><span class="co"># Also stored in</span></span>
<span><span class="va">pfi</span><span class="op">$</span><span class="va">importance</span></span>
<span><span class="co">#&gt; Key: &lt;feature&gt;</span></span>
<span><span class="co">#&gt;           feature  importance</span></span>
<span><span class="co">#&gt;            &lt;char&gt;       &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1:     bill_depth 0.029077040</span></span>
<span><span class="co">#&gt; 2:    bill_length 0.259471142</span></span>
<span><span class="co">#&gt; 3:      body_mass 0.007002288</span></span>
<span><span class="co">#&gt; 4: flipper_length 0.012819730</span></span>
<span><span class="co">#&gt; 5:         island 0.027897279</span></span>
<span><span class="co">#&gt; 6:            sex 0.005252988</span></span>
<span><span class="co">#&gt; 7:           year 0.001764556</span></span>
<span></span>
<span><span class="co"># Scores per resampling iteration and permutation iteration</span></span>
<span><span class="va">pfi</span><span class="op">$</span><span class="va">scores</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span>digits <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="18%">
<col width="12%">
<col width="12%">
<col width="21%">
<col width="21%">
<col width="13%">
</colgroup>
<thead><tr class="header">
<th align="left">feature</th>
<th align="right">iter_rsmp</th>
<th align="right">iter_perm</th>
<th align="right">classif.acc_orig</th>
<th align="right">classif.acc_perm</th>
<th align="right">importance</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">bill_depth</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">0.9565</td>
<td align="right">0.9217</td>
<td align="right">0.0348</td>
</tr>
<tr class="even">
<td align="left">bill_depth</td>
<td align="right">1</td>
<td align="right">2</td>
<td align="right">0.9565</td>
<td align="right">0.8870</td>
<td align="right">0.0696</td>
</tr>
<tr class="odd">
<td align="left">bill_depth</td>
<td align="right">1</td>
<td align="right">3</td>
<td align="right">0.9565</td>
<td align="right">0.9130</td>
<td align="right">0.0435</td>
</tr>
<tr class="even">
<td align="left">bill_depth</td>
<td align="right">1</td>
<td align="right">4</td>
<td align="right">0.9565</td>
<td align="right">0.9217</td>
<td align="right">0.0348</td>
</tr>
<tr class="odd">
<td align="left">bill_depth</td>
<td align="right">1</td>
<td align="right">5</td>
<td align="right">0.9565</td>
<td align="right">0.9217</td>
<td align="right">0.0348</td>
</tr>
<tr class="even">
<td align="left">bill_depth</td>
<td align="right">2</td>
<td align="right">1</td>
<td align="right">0.9826</td>
<td align="right">0.9652</td>
<td align="right">0.0174</td>
</tr>
<tr class="odd">
<td align="left">bill_depth</td>
<td align="right">2</td>
<td align="right">2</td>
<td align="right">0.9826</td>
<td align="right">0.9652</td>
<td align="right">0.0174</td>
</tr>
<tr class="even">
<td align="left">bill_depth</td>
<td align="right">2</td>
<td align="right">3</td>
<td align="right">0.9826</td>
<td align="right">0.9739</td>
<td align="right">0.0087</td>
</tr>
<tr class="odd">
<td align="left">bill_depth</td>
<td align="right">2</td>
<td align="right">4</td>
<td align="right">0.9826</td>
<td align="right">0.9826</td>
<td align="right">0.0000</td>
</tr>
<tr class="even">
<td align="left">bill_depth</td>
<td align="right">2</td>
<td align="right">5</td>
<td align="right">0.9826</td>
<td align="right">0.9652</td>
<td align="right">0.0174</td>
</tr>
<tr class="odd">
<td align="left">bill_depth</td>
<td align="right">3</td>
<td align="right">1</td>
<td align="right">1.0000</td>
<td align="right">0.9561</td>
<td align="right">0.0439</td>
</tr>
<tr class="even">
<td align="left">bill_depth</td>
<td align="right">3</td>
<td align="right">2</td>
<td align="right">1.0000</td>
<td align="right">0.9825</td>
<td align="right">0.0175</td>
</tr>
<tr class="odd">
<td align="left">bill_depth</td>
<td align="right">3</td>
<td align="right">3</td>
<td align="right">1.0000</td>
<td align="right">0.9649</td>
<td align="right">0.0351</td>
</tr>
<tr class="even">
<td align="left">bill_depth</td>
<td align="right">3</td>
<td align="right">4</td>
<td align="right">1.0000</td>
<td align="right">0.9825</td>
<td align="right">0.0175</td>
</tr>
<tr class="odd">
<td align="left">bill_depth</td>
<td align="right">3</td>
<td align="right">5</td>
<td align="right">1.0000</td>
<td align="right">0.9561</td>
<td align="right">0.0439</td>
</tr>
<tr class="even">
<td align="left">bill_length</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">0.9565</td>
<td align="right">0.7304</td>
<td align="right">0.2261</td>
</tr>
<tr class="odd">
<td align="left">bill_length</td>
<td align="right">1</td>
<td align="right">2</td>
<td align="right">0.9565</td>
<td align="right">0.7217</td>
<td align="right">0.2348</td>
</tr>
<tr class="even">
<td align="left">bill_length</td>
<td align="right">1</td>
<td align="right">3</td>
<td align="right">0.9565</td>
<td align="right">0.7391</td>
<td align="right">0.2174</td>
</tr>
<tr class="odd">
<td align="left">bill_length</td>
<td align="right">1</td>
<td align="right">4</td>
<td align="right">0.9565</td>
<td align="right">0.7304</td>
<td align="right">0.2261</td>
</tr>
<tr class="even">
<td align="left">bill_length</td>
<td align="right">1</td>
<td align="right">5</td>
<td align="right">0.9565</td>
<td align="right">0.6957</td>
<td align="right">0.2609</td>
</tr>
<tr class="odd">
<td align="left">bill_length</td>
<td align="right">2</td>
<td align="right">1</td>
<td align="right">0.9826</td>
<td align="right">0.7043</td>
<td align="right">0.2783</td>
</tr>
<tr class="even">
<td align="left">bill_length</td>
<td align="right">2</td>
<td align="right">2</td>
<td align="right">0.9826</td>
<td align="right">0.8000</td>
<td align="right">0.1826</td>
</tr>
<tr class="odd">
<td align="left">bill_length</td>
<td align="right">2</td>
<td align="right">3</td>
<td align="right">0.9826</td>
<td align="right">0.7565</td>
<td align="right">0.2261</td>
</tr>
<tr class="even">
<td align="left">bill_length</td>
<td align="right">2</td>
<td align="right">4</td>
<td align="right">0.9826</td>
<td align="right">0.7652</td>
<td align="right">0.2174</td>
</tr>
<tr class="odd">
<td align="left">bill_length</td>
<td align="right">2</td>
<td align="right">5</td>
<td align="right">0.9826</td>
<td align="right">0.7478</td>
<td align="right">0.2348</td>
</tr>
<tr class="even">
<td align="left">bill_length</td>
<td align="right">3</td>
<td align="right">1</td>
<td align="right">1.0000</td>
<td align="right">0.7018</td>
<td align="right">0.2982</td>
</tr>
<tr class="odd">
<td align="left">bill_length</td>
<td align="right">3</td>
<td align="right">2</td>
<td align="right">1.0000</td>
<td align="right">0.7281</td>
<td align="right">0.2719</td>
</tr>
<tr class="even">
<td align="left">bill_length</td>
<td align="right">3</td>
<td align="right">3</td>
<td align="right">1.0000</td>
<td align="right">0.6667</td>
<td align="right">0.3333</td>
</tr>
<tr class="odd">
<td align="left">bill_length</td>
<td align="right">3</td>
<td align="right">4</td>
<td align="right">1.0000</td>
<td align="right">0.6316</td>
<td align="right">0.3684</td>
</tr>
<tr class="even">
<td align="left">bill_length</td>
<td align="right">3</td>
<td align="right">5</td>
<td align="right">1.0000</td>
<td align="right">0.6842</td>
<td align="right">0.3158</td>
</tr>
<tr class="odd">
<td align="left">body_mass</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">0.9565</td>
<td align="right">0.9478</td>
<td align="right">0.0087</td>
</tr>
<tr class="even">
<td align="left">body_mass</td>
<td align="right">1</td>
<td align="right">2</td>
<td align="right">0.9565</td>
<td align="right">0.9565</td>
<td align="right">0.0000</td>
</tr>
<tr class="odd">
<td align="left">body_mass</td>
<td align="right">1</td>
<td align="right">3</td>
<td align="right">0.9565</td>
<td align="right">0.9391</td>
<td align="right">0.0174</td>
</tr>
<tr class="even">
<td align="left">body_mass</td>
<td align="right">1</td>
<td align="right">4</td>
<td align="right">0.9565</td>
<td align="right">0.9565</td>
<td align="right">0.0000</td>
</tr>
<tr class="odd">
<td align="left">body_mass</td>
<td align="right">1</td>
<td align="right">5</td>
<td align="right">0.9565</td>
<td align="right">0.9565</td>
<td align="right">0.0000</td>
</tr>
<tr class="even">
<td align="left">body_mass</td>
<td align="right">2</td>
<td align="right">1</td>
<td align="right">0.9826</td>
<td align="right">0.9826</td>
<td align="right">0.0000</td>
</tr>
<tr class="odd">
<td align="left">body_mass</td>
<td align="right">2</td>
<td align="right">2</td>
<td align="right">0.9826</td>
<td align="right">0.9826</td>
<td align="right">0.0000</td>
</tr>
<tr class="even">
<td align="left">body_mass</td>
<td align="right">2</td>
<td align="right">3</td>
<td align="right">0.9826</td>
<td align="right">0.9826</td>
<td align="right">0.0000</td>
</tr>
<tr class="odd">
<td align="left">body_mass</td>
<td align="right">2</td>
<td align="right">4</td>
<td align="right">0.9826</td>
<td align="right">0.9826</td>
<td align="right">0.0000</td>
</tr>
<tr class="even">
<td align="left">body_mass</td>
<td align="right">2</td>
<td align="right">5</td>
<td align="right">0.9826</td>
<td align="right">0.9826</td>
<td align="right">0.0000</td>
</tr>
<tr class="odd">
<td align="left">body_mass</td>
<td align="right">3</td>
<td align="right">1</td>
<td align="right">1.0000</td>
<td align="right">0.9912</td>
<td align="right">0.0088</td>
</tr>
<tr class="even">
<td align="left">body_mass</td>
<td align="right">3</td>
<td align="right">2</td>
<td align="right">1.0000</td>
<td align="right">0.9825</td>
<td align="right">0.0175</td>
</tr>
<tr class="odd">
<td align="left">body_mass</td>
<td align="right">3</td>
<td align="right">3</td>
<td align="right">1.0000</td>
<td align="right">0.9737</td>
<td align="right">0.0263</td>
</tr>
<tr class="even">
<td align="left">body_mass</td>
<td align="right">3</td>
<td align="right">4</td>
<td align="right">1.0000</td>
<td align="right">0.9825</td>
<td align="right">0.0175</td>
</tr>
<tr class="odd">
<td align="left">body_mass</td>
<td align="right">3</td>
<td align="right">5</td>
<td align="right">1.0000</td>
<td align="right">0.9912</td>
<td align="right">0.0088</td>
</tr>
<tr class="even">
<td align="left">flipper_length</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">0.9565</td>
<td align="right">0.9565</td>
<td align="right">0.0000</td>
</tr>
<tr class="odd">
<td align="left">flipper_length</td>
<td align="right">1</td>
<td align="right">2</td>
<td align="right">0.9565</td>
<td align="right">0.9217</td>
<td align="right">0.0348</td>
</tr>
<tr class="even">
<td align="left">flipper_length</td>
<td align="right">1</td>
<td align="right">3</td>
<td align="right">0.9565</td>
<td align="right">0.9304</td>
<td align="right">0.0261</td>
</tr>
<tr class="odd">
<td align="left">flipper_length</td>
<td align="right">1</td>
<td align="right">4</td>
<td align="right">0.9565</td>
<td align="right">0.9391</td>
<td align="right">0.0174</td>
</tr>
<tr class="even">
<td align="left">flipper_length</td>
<td align="right">1</td>
<td align="right">5</td>
<td align="right">0.9565</td>
<td align="right">0.9304</td>
<td align="right">0.0261</td>
</tr>
<tr class="odd">
<td align="left">flipper_length</td>
<td align="right">2</td>
<td align="right">1</td>
<td align="right">0.9826</td>
<td align="right">0.9913</td>
<td align="right">-0.0087</td>
</tr>
<tr class="even">
<td align="left">flipper_length</td>
<td align="right">2</td>
<td align="right">2</td>
<td align="right">0.9826</td>
<td align="right">0.9826</td>
<td align="right">0.0000</td>
</tr>
<tr class="odd">
<td align="left">flipper_length</td>
<td align="right">2</td>
<td align="right">3</td>
<td align="right">0.9826</td>
<td align="right">1.0000</td>
<td align="right">-0.0174</td>
</tr>
<tr class="even">
<td align="left">flipper_length</td>
<td align="right">2</td>
<td align="right">4</td>
<td align="right">0.9826</td>
<td align="right">0.9826</td>
<td align="right">0.0000</td>
</tr>
<tr class="odd">
<td align="left">flipper_length</td>
<td align="right">2</td>
<td align="right">5</td>
<td align="right">0.9826</td>
<td align="right">0.9826</td>
<td align="right">0.0000</td>
</tr>
<tr class="even">
<td align="left">flipper_length</td>
<td align="right">3</td>
<td align="right">1</td>
<td align="right">1.0000</td>
<td align="right">0.9561</td>
<td align="right">0.0439</td>
</tr>
<tr class="odd">
<td align="left">flipper_length</td>
<td align="right">3</td>
<td align="right">2</td>
<td align="right">1.0000</td>
<td align="right">0.9737</td>
<td align="right">0.0263</td>
</tr>
<tr class="even">
<td align="left">flipper_length</td>
<td align="right">3</td>
<td align="right">3</td>
<td align="right">1.0000</td>
<td align="right">0.9912</td>
<td align="right">0.0088</td>
</tr>
<tr class="odd">
<td align="left">flipper_length</td>
<td align="right">3</td>
<td align="right">4</td>
<td align="right">1.0000</td>
<td align="right">0.9912</td>
<td align="right">0.0088</td>
</tr>
<tr class="even">
<td align="left">flipper_length</td>
<td align="right">3</td>
<td align="right">5</td>
<td align="right">1.0000</td>
<td align="right">0.9737</td>
<td align="right">0.0263</td>
</tr>
<tr class="odd">
<td align="left">island</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">0.9565</td>
<td align="right">0.9304</td>
<td align="right">0.0261</td>
</tr>
<tr class="even">
<td align="left">island</td>
<td align="right">1</td>
<td align="right">2</td>
<td align="right">0.9565</td>
<td align="right">0.9391</td>
<td align="right">0.0174</td>
</tr>
<tr class="odd">
<td align="left">island</td>
<td align="right">1</td>
<td align="right">3</td>
<td align="right">0.9565</td>
<td align="right">0.9391</td>
<td align="right">0.0174</td>
</tr>
<tr class="even">
<td align="left">island</td>
<td align="right">1</td>
<td align="right">4</td>
<td align="right">0.9565</td>
<td align="right">0.9391</td>
<td align="right">0.0174</td>
</tr>
<tr class="odd">
<td align="left">island</td>
<td align="right">1</td>
<td align="right">5</td>
<td align="right">0.9565</td>
<td align="right">0.9478</td>
<td align="right">0.0087</td>
</tr>
<tr class="even">
<td align="left">island</td>
<td align="right">2</td>
<td align="right">1</td>
<td align="right">0.9826</td>
<td align="right">0.9391</td>
<td align="right">0.0435</td>
</tr>
<tr class="odd">
<td align="left">island</td>
<td align="right">2</td>
<td align="right">2</td>
<td align="right">0.9826</td>
<td align="right">0.9652</td>
<td align="right">0.0174</td>
</tr>
<tr class="even">
<td align="left">island</td>
<td align="right">2</td>
<td align="right">3</td>
<td align="right">0.9826</td>
<td align="right">0.9391</td>
<td align="right">0.0435</td>
</tr>
<tr class="odd">
<td align="left">island</td>
<td align="right">2</td>
<td align="right">4</td>
<td align="right">0.9826</td>
<td align="right">0.9391</td>
<td align="right">0.0435</td>
</tr>
<tr class="even">
<td align="left">island</td>
<td align="right">2</td>
<td align="right">5</td>
<td align="right">0.9826</td>
<td align="right">0.9217</td>
<td align="right">0.0609</td>
</tr>
<tr class="odd">
<td align="left">island</td>
<td align="right">3</td>
<td align="right">1</td>
<td align="right">1.0000</td>
<td align="right">0.9825</td>
<td align="right">0.0175</td>
</tr>
<tr class="even">
<td align="left">island</td>
<td align="right">3</td>
<td align="right">2</td>
<td align="right">1.0000</td>
<td align="right">0.9825</td>
<td align="right">0.0175</td>
</tr>
<tr class="odd">
<td align="left">island</td>
<td align="right">3</td>
<td align="right">3</td>
<td align="right">1.0000</td>
<td align="right">0.9649</td>
<td align="right">0.0351</td>
</tr>
<tr class="even">
<td align="left">island</td>
<td align="right">3</td>
<td align="right">4</td>
<td align="right">1.0000</td>
<td align="right">0.9825</td>
<td align="right">0.0175</td>
</tr>
<tr class="odd">
<td align="left">island</td>
<td align="right">3</td>
<td align="right">5</td>
<td align="right">1.0000</td>
<td align="right">0.9649</td>
<td align="right">0.0351</td>
</tr>
<tr class="even">
<td align="left">sex</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">0.9565</td>
<td align="right">0.9478</td>
<td align="right">0.0087</td>
</tr>
<tr class="odd">
<td align="left">sex</td>
<td align="right">1</td>
<td align="right">2</td>
<td align="right">0.9565</td>
<td align="right">0.9565</td>
<td align="right">0.0000</td>
</tr>
<tr class="even">
<td align="left">sex</td>
<td align="right">1</td>
<td align="right">3</td>
<td align="right">0.9565</td>
<td align="right">0.9565</td>
<td align="right">0.0000</td>
</tr>
<tr class="odd">
<td align="left">sex</td>
<td align="right">1</td>
<td align="right">4</td>
<td align="right">0.9565</td>
<td align="right">0.9478</td>
<td align="right">0.0087</td>
</tr>
<tr class="even">
<td align="left">sex</td>
<td align="right">1</td>
<td align="right">5</td>
<td align="right">0.9565</td>
<td align="right">0.9565</td>
<td align="right">0.0000</td>
</tr>
<tr class="odd">
<td align="left">sex</td>
<td align="right">2</td>
<td align="right">1</td>
<td align="right">0.9826</td>
<td align="right">0.9826</td>
<td align="right">0.0000</td>
</tr>
<tr class="even">
<td align="left">sex</td>
<td align="right">2</td>
<td align="right">2</td>
<td align="right">0.9826</td>
<td align="right">0.9826</td>
<td align="right">0.0000</td>
</tr>
<tr class="odd">
<td align="left">sex</td>
<td align="right">2</td>
<td align="right">3</td>
<td align="right">0.9826</td>
<td align="right">0.9826</td>
<td align="right">0.0000</td>
</tr>
<tr class="even">
<td align="left">sex</td>
<td align="right">2</td>
<td align="right">4</td>
<td align="right">0.9826</td>
<td align="right">0.9826</td>
<td align="right">0.0000</td>
</tr>
<tr class="odd">
<td align="left">sex</td>
<td align="right">2</td>
<td align="right">5</td>
<td align="right">0.9826</td>
<td align="right">0.9826</td>
<td align="right">0.0000</td>
</tr>
<tr class="even">
<td align="left">sex</td>
<td align="right">3</td>
<td align="right">1</td>
<td align="right">1.0000</td>
<td align="right">0.9825</td>
<td align="right">0.0175</td>
</tr>
<tr class="odd">
<td align="left">sex</td>
<td align="right">3</td>
<td align="right">2</td>
<td align="right">1.0000</td>
<td align="right">0.9912</td>
<td align="right">0.0088</td>
</tr>
<tr class="even">
<td align="left">sex</td>
<td align="right">3</td>
<td align="right">3</td>
<td align="right">1.0000</td>
<td align="right">0.9912</td>
<td align="right">0.0088</td>
</tr>
<tr class="odd">
<td align="left">sex</td>
<td align="right">3</td>
<td align="right">4</td>
<td align="right">1.0000</td>
<td align="right">0.9912</td>
<td align="right">0.0088</td>
</tr>
<tr class="even">
<td align="left">sex</td>
<td align="right">3</td>
<td align="right">5</td>
<td align="right">1.0000</td>
<td align="right">0.9825</td>
<td align="right">0.0175</td>
</tr>
<tr class="odd">
<td align="left">year</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">0.9565</td>
<td align="right">0.9565</td>
<td align="right">0.0000</td>
</tr>
<tr class="even">
<td align="left">year</td>
<td align="right">1</td>
<td align="right">2</td>
<td align="right">0.9565</td>
<td align="right">0.9565</td>
<td align="right">0.0000</td>
</tr>
<tr class="odd">
<td align="left">year</td>
<td align="right">1</td>
<td align="right">3</td>
<td align="right">0.9565</td>
<td align="right">0.9565</td>
<td align="right">0.0000</td>
</tr>
<tr class="even">
<td align="left">year</td>
<td align="right">1</td>
<td align="right">4</td>
<td align="right">0.9565</td>
<td align="right">0.9565</td>
<td align="right">0.0000</td>
</tr>
<tr class="odd">
<td align="left">year</td>
<td align="right">1</td>
<td align="right">5</td>
<td align="right">0.9565</td>
<td align="right">0.9565</td>
<td align="right">0.0000</td>
</tr>
<tr class="even">
<td align="left">year</td>
<td align="right">2</td>
<td align="right">1</td>
<td align="right">0.9826</td>
<td align="right">0.9826</td>
<td align="right">0.0000</td>
</tr>
<tr class="odd">
<td align="left">year</td>
<td align="right">2</td>
<td align="right">2</td>
<td align="right">0.9826</td>
<td align="right">0.9913</td>
<td align="right">-0.0087</td>
</tr>
<tr class="even">
<td align="left">year</td>
<td align="right">2</td>
<td align="right">3</td>
<td align="right">0.9826</td>
<td align="right">0.9826</td>
<td align="right">0.0000</td>
</tr>
<tr class="odd">
<td align="left">year</td>
<td align="right">2</td>
<td align="right">4</td>
<td align="right">0.9826</td>
<td align="right">0.9826</td>
<td align="right">0.0000</td>
</tr>
<tr class="even">
<td align="left">year</td>
<td align="right">2</td>
<td align="right">5</td>
<td align="right">0.9826</td>
<td align="right">0.9913</td>
<td align="right">-0.0087</td>
</tr>
<tr class="odd">
<td align="left">year</td>
<td align="right">3</td>
<td align="right">1</td>
<td align="right">1.0000</td>
<td align="right">0.9825</td>
<td align="right">0.0175</td>
</tr>
<tr class="even">
<td align="left">year</td>
<td align="right">3</td>
<td align="right">2</td>
<td align="right">1.0000</td>
<td align="right">1.0000</td>
<td align="right">0.0000</td>
</tr>
<tr class="odd">
<td align="left">year</td>
<td align="right">3</td>
<td align="right">3</td>
<td align="right">1.0000</td>
<td align="right">0.9912</td>
<td align="right">0.0088</td>
</tr>
<tr class="even">
<td align="left">year</td>
<td align="right">3</td>
<td align="right">4</td>
<td align="right">1.0000</td>
<td align="right">0.9825</td>
<td align="right">0.0175</td>
</tr>
<tr class="odd">
<td align="left">year</td>
<td align="right">3</td>
<td align="right">5</td>
<td align="right">1.0000</td>
<td align="right">1.0000</td>
<td align="right">0.0000</td>
</tr>
</tbody>
</table>
</div>
<div class="section level2">
<h2 id="conditional-feature-importance-cfi">Conditional Feature Importance (CFI)<a class="anchor" aria-label="anchor" href="#conditional-feature-importance-cfi"></a>
</h2>
<p>CFI uses conditional sampling to preserve the joint distribution of
all other features when perturbing a feature of interest. By default we
use Adversarial Random Forests (ARF) as conditional sampler internally,
but it can be provided explicity, as we usually want to supply
additional arguments to <code><a href="https://bips-hb.github.io/arf/reference/adversarial_rf.html" class="external-link">arf::adversarial_rf()</a></code> or
<code><a href="https://bips-hb.github.io/arf/reference/forde.html" class="external-link">arf::forde()</a></code>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sampler</span> <span class="op">=</span> <span class="va"><a href="../reference/ARFSampler.html">ARFSampler</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>  task <span class="op">=</span> <span class="va">task</span>, </span>
<span>  arf_args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>verbose <span class="op">=</span> <span class="cn">FALSE</span>, parallel <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>,</span>
<span>  forde_args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>finite_bounds <span class="op">=</span> <span class="st">"no"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: executing %dopar% sequentially: no parallel backend registered</span></span>
<span></span>
<span><span class="co"># Example sampling for 5 randomly chosen rows from the task</span></span>
<span><span class="va">sampler</span><span class="op">$</span><span class="fu">sample</span><span class="op">(</span></span>
<span>  feature <span class="op">=</span> <span class="st">"bill_length"</span>, </span>
<span>  data <span class="op">=</span> <span class="va">task</span><span class="op">$</span><span class="fu">data</span><span class="op">(</span>rows <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">task</span><span class="op">$</span><span class="va">nrow</span>, size <span class="op">=</span> <span class="fl">5</span><span class="op">)</span><span class="op">)</span>, </span>
<span>  conditioning_features <span class="op">=</span> <span class="st">"body_mass"</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt;      species bill_depth bill_length body_mass flipper_length island    sex</span></span>
<span><span class="co">#&gt;       &lt;fctr&gt;      &lt;num&gt;       &lt;num&gt;     &lt;int&gt;          &lt;int&gt; &lt;fctr&gt; &lt;fctr&gt;</span></span>
<span><span class="co">#&gt; 1:    Adelie       19.7        43.3      4400            196  Dream   male</span></span>
<span><span class="co">#&gt; 2:    Gentoo       14.2        43.7      4600            209 Biscoe female</span></span>
<span><span class="co">#&gt; 3:    Adelie       17.8        34.8      3450            195  Dream female</span></span>
<span><span class="co">#&gt; 4: Chinstrap       19.0        52.4      3950            201  Dream   male</span></span>
<span><span class="co">#&gt; 5:    Adelie       18.0        38.3      3150            182  Dream female</span></span>
<span><span class="co">#&gt;     year</span></span>
<span><span class="co">#&gt;    &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1:  2007</span></span>
<span><span class="co">#&gt; 2:  2008</span></span>
<span><span class="co">#&gt; 3:  2009</span></span>
<span><span class="co">#&gt; 4:  2009</span></span>
<span><span class="co">#&gt; 5:  2007</span></span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cfi</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/CFI.html">CFI</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>  task <span class="op">=</span> <span class="va">task</span>,</span>
<span>  learner <span class="op">=</span> <span class="va">learner</span>,</span>
<span>  measure <span class="op">=</span> <span class="va">measure</span>,</span>
<span>  resampling <span class="op">=</span> <span class="va">resampling</span>,</span>
<span>  iters_perm <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  sampler <span class="op">=</span> <span class="va">sampler</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Compute importance scores</span></span>
<span><span class="va">cfi_results</span> <span class="op">&lt;-</span> <span class="va">cfi</span><span class="op">$</span><span class="fu">compute</span><span class="op">(</span>relation <span class="op">=</span> <span class="st">"difference"</span><span class="op">)</span></span>
<span><span class="va">cfi_results</span></span>
<span><span class="co">#&gt; Key: &lt;feature&gt;</span></span>
<span><span class="co">#&gt;           feature    importance</span></span>
<span><span class="co">#&gt;            &lt;char&gt;         &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1:     bill_depth  0.0005949657</span></span>
<span><span class="co">#&gt; 2:    bill_length  0.0889905924</span></span>
<span><span class="co">#&gt; 3:      body_mass  0.0017543860</span></span>
<span><span class="co">#&gt; 4: flipper_length -0.0040579710</span></span>
<span><span class="co">#&gt; 5:         island  0.0104907196</span></span>
<span><span class="co">#&gt; 6:            sex  0.0005847953</span></span>
<span><span class="co">#&gt; 7:           year -0.0005797101</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="relative-feature-importance-rfi">Relative Feature Importance (RFI)<a class="anchor" aria-label="anchor" href="#relative-feature-importance-rfi"></a>
</h2>
<p>RFI conditions on a specific subset of features as opposed to just
one as in CFI, measuring importance relative to those features.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">conditioning_set</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"sex"</span>, <span class="st">"year"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">rfi</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/RFI.html">RFI</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>  task <span class="op">=</span> <span class="va">task</span>,</span>
<span>  learner <span class="op">=</span> <span class="va">learner</span>,</span>
<span>  measure <span class="op">=</span> <span class="va">measure</span>,</span>
<span>  resampling <span class="op">=</span> <span class="va">resampling</span>,</span>
<span>  conditioning_set <span class="op">=</span> <span class="va">conditioning_set</span>,</span>
<span>  iters_perm <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  sampler <span class="op">=</span> <span class="va">sampler</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Compute importance scores</span></span>
<span><span class="va">rfi_results</span> <span class="op">&lt;-</span> <span class="va">rfi</span><span class="op">$</span><span class="fu">compute</span><span class="op">(</span>relation <span class="op">=</span> <span class="st">"difference"</span><span class="op">)</span></span>
<span><span class="va">rfi_results</span></span>
<span><span class="co">#&gt; Key: &lt;feature&gt;</span></span>
<span><span class="co">#&gt;           feature  importance</span></span>
<span><span class="co">#&gt;            &lt;char&gt;       &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1:     bill_depth 0.008761759</span></span>
<span><span class="co">#&gt; 2:    bill_length 0.273292652</span></span>
<span><span class="co">#&gt; 3:      body_mass 0.001164505</span></span>
<span><span class="co">#&gt; 4: flipper_length 0.017437071</span></span>
<span><span class="co">#&gt; 5:         island 0.024490211</span></span>
<span><span class="co">#&gt; 6:            sex 0.000000000</span></span>
<span><span class="co">#&gt; 7:           year 0.000000000</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="comparing-methods">Comparing Methods<a class="anchor" aria-label="anchor" href="#comparing-methods"></a>
</h2>
<p>Now let’s compare the results from all three methods:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Combine results for comparison</span></span>
<span><span class="va">comparison</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span></span>
<span>  <span class="va">pfi_results</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span><span class="va">feature</span>, pfi <span class="op">=</span> <span class="va">importance</span><span class="op">)</span><span class="op">]</span>,</span>
<span>  <span class="va">cfi_results</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span><span class="va">feature</span>, cfi <span class="op">=</span> <span class="va">importance</span><span class="op">)</span><span class="op">]</span>,</span>
<span>  by <span class="op">=</span> <span class="st">"feature"</span></span>
<span><span class="op">)</span></span>
<span><span class="va">comparison</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span></span>
<span>  <span class="va">comparison</span>,</span>
<span>  <span class="va">rfi_results</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span><span class="va">feature</span>, rfi <span class="op">=</span> <span class="va">importance</span><span class="op">)</span><span class="op">]</span>,</span>
<span>  by <span class="op">=</span> <span class="st">"feature"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">comparison</span></span>
<span><span class="co">#&gt; Key: &lt;feature&gt;</span></span>
<span><span class="co">#&gt;           feature         pfi           cfi         rfi</span></span>
<span><span class="co">#&gt;            &lt;char&gt;       &lt;num&gt;         &lt;num&gt;       &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1:     bill_depth 0.029077040  0.0005949657 0.008761759</span></span>
<span><span class="co">#&gt; 2:    bill_length 0.259471142  0.0889905924 0.273292652</span></span>
<span><span class="co">#&gt; 3:      body_mass 0.007002288  0.0017543860 0.001164505</span></span>
<span><span class="co">#&gt; 4: flipper_length 0.012819730 -0.0040579710 0.017437071</span></span>
<span><span class="co">#&gt; 5:         island 0.027897279  0.0104907196 0.024490211</span></span>
<span><span class="co">#&gt; 6:            sex 0.005252988  0.0005847953 0.000000000</span></span>
<span><span class="co">#&gt; 7:           year 0.001764556 -0.0005797101 0.000000000</span></span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">comparison</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span></span>
<span>    digits <span class="op">=</span> <span class="fl">4</span>, </span>
<span>    caption <span class="op">=</span> <span class="st">"Feature Importance Comparison (Difference Scores)"</span>,</span>
<span>    col.names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Feature"</span>, <span class="st">"PFI"</span>, <span class="st">"CFI"</span>, <span class="st">"RFI"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<table class="table">
<caption>Feature Importance Comparison (Difference Scores)</caption>
<thead><tr class="header">
<th align="left">Feature</th>
<th align="right">PFI</th>
<th align="right">CFI</th>
<th align="right">RFI</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">bill_depth</td>
<td align="right">0.0291</td>
<td align="right">0.0006</td>
<td align="right">0.0088</td>
</tr>
<tr class="even">
<td align="left">bill_length</td>
<td align="right">0.2595</td>
<td align="right">0.0890</td>
<td align="right">0.2733</td>
</tr>
<tr class="odd">
<td align="left">body_mass</td>
<td align="right">0.0070</td>
<td align="right">0.0018</td>
<td align="right">0.0012</td>
</tr>
<tr class="even">
<td align="left">flipper_length</td>
<td align="right">0.0128</td>
<td align="right">-0.0041</td>
<td align="right">0.0174</td>
</tr>
<tr class="odd">
<td align="left">island</td>
<td align="right">0.0279</td>
<td align="right">0.0105</td>
<td align="right">0.0245</td>
</tr>
<tr class="even">
<td align="left">sex</td>
<td align="right">0.0053</td>
<td align="right">0.0006</td>
<td align="right">0.0000</td>
</tr>
<tr class="odd">
<td align="left">year</td>
<td align="right">0.0018</td>
<td align="right">-0.0006</td>
<td align="right">0.0000</td>
</tr>
</tbody>
</table>
</div>
<div class="section level2">
<h2 id="visualization">Visualization<a class="anchor" aria-label="anchor" href="#visualization"></a>
</h2>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Reshape data for plotting</span></span>
<span><span class="va">plot_data</span> <span class="op">&lt;-</span> <span class="va">comparison</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/melt.data.table.html" class="external-link">melt</a></span><span class="op">(</span></span>
<span>    id.vars <span class="op">=</span> <span class="st">"feature"</span>,</span>
<span>    value.name <span class="op">=</span> <span class="st">"importance"</span>,</span>
<span>    variable.name <span class="op">=</span> <span class="st">"method"</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># Clean up method names</span></span>
<span><span class="va">plot_data</span><span class="op">[</span>, <span class="va">method</span> <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/r/base/chartr.html" class="external-link">toupper</a></span><span class="op">(</span><span class="va">method</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Create the plot</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">plot_data</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">importance</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/reorder.factor.html" class="external-link">reorder</a></span><span class="op">(</span><span class="va">feature</span>, <span class="va">importance</span><span class="op">)</span>, fill <span class="op">=</span> <span class="va">method</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_col</a></span><span class="op">(</span>position <span class="op">=</span> <span class="st">"dodge"</span>, alpha <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_fill_brewer</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Dark2"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Feature Importance Comparison"</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="fu">glue</span><span class="fu">::</span><span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html" class="external-link">glue</a></span><span class="op">(</span></span>
<span>      <span class="st">"Task: {task$id} </span></span>
<span><span class="st">      Measure: {measure$id}</span></span>
<span><span class="st">      RFI conditioned on: {paste(conditioning_set, collapse = ', ')}"</span><span class="op">)</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"Importance Score (Difference)"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Feature"</span>,</span>
<span>    fill <span class="op">=</span> <span class="st">"Method"</span>,</span>
<span>    caption <span class="op">=</span> <span class="fu">glue</span><span class="fu">::</span><span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html" class="external-link">glue</a></span><span class="op">(</span><span class="st">"Using {resampling$iters}-fold cross-validation"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">16</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span></span>
<span>    legend.position <span class="op">=</span> <span class="st">"bottom"</span>,</span>
<span>    plot.title.position <span class="op">=</span> <span class="st">"plot"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><img src="perturbation-importance_files/figure-html/visualization-1.png" width="768"></p>
</div>
<div class="section level2">
<h2 id="understanding-the-differences">Understanding the Differences<a class="anchor" aria-label="anchor" href="#understanding-the-differences"></a>
</h2>
<p>The three methods can yield different results because they make
different assumptions:</p>
<ol style="list-style-type: decimal">
<li><p><strong>PFI</strong> assumes features are independent and
measures the marginal importance of each feature.</p></li>
<li><p><strong>CFI</strong> preserves the conditional distribution
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>X</mi><mrow><mo>−</mo><mi>j</mi></mrow></msub><mo stretchy="false" form="prefix">|</mo><msub><mi>X</mi><mi>j</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">P(X_{-j} | X_j)</annotation></semantics></math>
when perturbing feature
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>j</mi><annotation encoding="application/x-tex">j</annotation></semantics></math>,
providing a more realistic assessment when features are
correlated.</p></li>
<li><p><strong>RFI</strong> measures importance relative to a specific
conditioning set, answering “what additional information does this
feature provide beyond what we already know from features A, B,
C?”</p></li>
</ol>
<p>In our penguin example: - Features like bill dimensions and body mass
are likely correlated - CFI accounts for these correlations when
measuring importance - RFI shows which features add value beyond
bill_length and flipper_length</p>
</div>
<div class="section level2">
<h2 id="advanced-usage">Advanced Usage<a class="anchor" aria-label="anchor" href="#advanced-usage"></a>
</h2>
<div class="section level3">
<h3 id="custom-samplers">Custom Samplers<a class="anchor" aria-label="anchor" href="#custom-samplers"></a>
</h3>
<p>You can also provide custom samplers for more control:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create a custom ARF sampler with specific parameters</span></span>
<span><span class="va">custom_sampler</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/ARFSampler.html">ARFSampler</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>  task <span class="op">=</span> <span class="va">task</span>,</span>
<span>  arf_args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>num_trees <span class="op">=</span> <span class="fl">50</span><span class="op">)</span>,  <span class="co"># Fewer trees for faster computation</span></span>
<span>  forde_args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>finite_bounds <span class="op">=</span> <span class="st">"local"</span><span class="op">)</span> <span class="co"># Avoid out of distribution samples</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">cfi_custom</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/CFI.html">CFI</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>  task <span class="op">=</span> <span class="va">task</span>,</span>
<span>  learner <span class="op">=</span> <span class="va">learner</span>,</span>
<span>  measure <span class="op">=</span> <span class="va">measure</span>,</span>
<span>  resampling <span class="op">=</span> <span class="va">resampling</span>,</span>
<span>  sampler <span class="op">=</span> <span class="va">custom_sampler</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="accessing-detailed-results">Accessing Detailed Results<a class="anchor" aria-label="anchor" href="#accessing-detailed-results"></a>
</h3>
<p>As mentioned, individual scores per resampling iteration and
permutation iteration are kept in <code>$scores</code>.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">detailed_scores</span> <span class="op">&lt;-</span> <span class="va">pfi</span><span class="op">$</span><span class="va">scores</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">detailed_scores</span><span class="op">)</span></span>
<span><span class="co">#&gt; Key: &lt;feature, iter_rsmp&gt;</span></span>
<span><span class="co">#&gt;       feature iter_rsmp iter_perm classif.acc_orig classif.acc_perm importance</span></span>
<span><span class="co">#&gt;        &lt;char&gt;     &lt;int&gt;     &lt;int&gt;            &lt;num&gt;            &lt;num&gt;      &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1: bill_depth         1         1        0.9565217        0.9217391 0.03478261</span></span>
<span><span class="co">#&gt; 2: bill_depth         1         2        0.9565217        0.8869565 0.06956522</span></span>
<span><span class="co">#&gt; 3: bill_depth         1         3        0.9565217        0.9130435 0.04347826</span></span>
<span><span class="co">#&gt; 4: bill_depth         1         4        0.9565217        0.9217391 0.03478261</span></span>
<span><span class="co">#&gt; 5: bill_depth         1         5        0.9565217        0.9217391 0.03478261</span></span>
<span><span class="co">#&gt; 6: bill_depth         2         1        0.9826087        0.9652174 0.01739130</span></span>
<span></span>
<span><span class="co"># Summarize variability across iterations</span></span>
<span><span class="va">score_summary</span> <span class="op">&lt;-</span> <span class="va">detailed_scores</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span></span>
<span>  mean_importance <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">importance</span><span class="op">)</span>,</span>
<span>  sd_importance <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">importance</span><span class="op">)</span>,</span>
<span>  n_iterations <span class="op">=</span> <span class="va">.N</span></span>
<span><span class="op">)</span>, by <span class="op">=</span> <span class="va">feature</span><span class="op">]</span></span>
<span></span>
<span><span class="va">score_summary</span></span>
<span><span class="co">#&gt; Key: &lt;feature&gt;</span></span>
<span><span class="co">#&gt;           feature mean_importance sd_importance n_iterations</span></span>
<span><span class="co">#&gt;            &lt;char&gt;           &lt;num&gt;         &lt;num&gt;        &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1:     bill_depth     0.029077040   0.017635396           15</span></span>
<span><span class="co">#&gt; 2:    bill_length     0.259471142   0.051076252           15</span></span>
<span><span class="co">#&gt; 3:      body_mass     0.007002288   0.008882485           15</span></span>
<span><span class="co">#&gt; 4: flipper_length     0.012819730   0.017420922           15</span></span>
<span><span class="co">#&gt; 5:         island     0.027897279   0.014769513           15</span></span>
<span><span class="co">#&gt; 6:            sex     0.005252988   0.006457193           15</span></span>
<span><span class="co">#&gt; 7:           year     0.001764556   0.007545314           15</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">score_summary</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span></span>
<span>  y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/reorder.factor.html" class="external-link">reorder</a></span><span class="op">(</span><span class="va">feature</span>, <span class="va">mean_importance</span><span class="op">)</span>, </span>
<span>  xmin <span class="op">=</span> <span class="va">mean_importance</span> <span class="op">-</span> <span class="va">sd_importance</span>, </span>
<span>  xmax <span class="op">=</span> <span class="va">mean_importance</span> <span class="op">+</span> <span class="va">sd_importance</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_errorbarh.html" class="external-link">geom_errorbarh</a></span><span class="op">(</span>linewidth <span class="op">=</span> <span class="fl">1</span>, height <span class="op">=</span> <span class="fl">.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Permutation Feature Importance: Mean ± SD"</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="fu">glue</span><span class="fu">::</span><span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html" class="external-link">glue</a></span><span class="op">(</span></span>
<span>      <span class="st">"Task: {task$id} </span></span>
<span><span class="st">      Measure: {measure$id}"</span><span class="op">)</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"PFI Score (Difference)"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Feature"</span>,</span>
<span>    caption <span class="op">=</span> <span class="fu">glue</span><span class="fu">::</span><span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html" class="external-link">glue</a></span><span class="op">(</span><span class="st">"Using {resampling$iters}-fold cross-validation and {pfi$param_set$values$iters_perm} permutations each"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">16</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span></span>
<span>    legend.position <span class="op">=</span> <span class="st">"bottom"</span>,</span>
<span>    plot.title.position <span class="op">=</span> <span class="st">"plot"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><img src="perturbation-importance_files/figure-html/detailed-scores-1.png" width="700"></p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Lukas Burk.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
