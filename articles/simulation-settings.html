<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Simulation Settings for Feature Importance Methods • xplainfi</title>
<!-- mathjax math --><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script><script>
  window.MathJax = {
    chtml: {
      fontURL: "https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/output/chtml/fonts/woff-v2"
    }
  };
</script><script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Roboto-0.4.10/font.css" rel="stylesheet">
<link href="../deps/JetBrains_Mono-0.4.10/font.css" rel="stylesheet">
<link href="../deps/Roboto_Slab-0.4.10/font.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Simulation Settings for Feature Importance Methods">
<script defer src="https://umami.jemu.name/script.js" data-website-id="248c8668-4908-4c63-86f7-db0a1b19758a"></script>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">xplainfi</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/xplainfi.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><h6 class="dropdown-header" data-toc-skip>Method Showcase</h6></li>
    <li><a class="dropdown-item" href="../articles/perturbation-importance.html">Perturbation-Based Methods (PFI, CFI, RFI)</a></li>
    <li><a class="dropdown-item" href="../articles/loco-loci.html">Leave-Out/In Methods (LOCO, LOCI)</a></li>
    <li><a class="dropdown-item" href="../articles/sage-methods.html">Shapley Additive Global Importance (SAGE)</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Testing &amp; Validation</h6></li>
    <li><a class="dropdown-item" href="../articles/simulation-settings.html">Simulation Settings</a></li>
    <li><a class="dropdown-item" href="../articles/fippy-comparison.html">Comparison with fippy (Python)</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/jemus42/xplainfi/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">



<link href="simulation-settings_files/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet">
<script src="simulation-settings_files/htmlwidgets-1.6.4/htmlwidgets.js"></script><script src="simulation-settings_files/viz-1.8.2/viz.js"></script><link href="simulation-settings_files/DiagrammeR-styles-0.2/styles.css" rel="stylesheet">
<script src="simulation-settings_files/grViz-binding-1.0.11/grViz.js"></script><div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Simulation Settings for Feature Importance Methods</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/jemus42/xplainfi/blob/main/vignettes/articles/simulation-settings.Rmd" class="external-link"><code>vignettes/articles/simulation-settings.Rmd</code></a></small>
      <div class="d-none name"><code>simulation-settings.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://jemus42.github.io/xplainfi/">xplainfi</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rich-iannone.github.io/DiagrammeR/" class="external-link">DiagrammeR</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mlr3learners.mlr-org.com" class="external-link">mlr3learners</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required package: mlr3</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The <code>xplainfi</code> package provides several data generating
processes (DGPs) designed to illustrate specific strengths and
weaknesses of different feature importance methods. Each DGP focuses on
one primary challenge to make the differences between methods clear.</p>
<p>This article provides a comprehensive overview of all simulation
settings, including their mathematical formulations and causal
structures visualized as directed acyclic graphs (DAGs).</p>
</div>
<div class="section level2">
<h2 id="overview-of-simulation-settings">Overview of Simulation Settings<a class="anchor" aria-label="anchor" href="#overview-of-simulation-settings"></a>
</h2>
<table class="table">
<caption>Overview of simulation settings and expected method
behavior</caption>
<colgroup>
<col width="21%">
<col width="25%">
<col width="22%">
<col width="29%">
</colgroup>
<thead><tr class="header">
<th align="left">DGP</th>
<th align="left">Challenge</th>
<th align="left">PFI Behavior</th>
<th align="left">CFI Behavior</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">sim_dgp_correlated</td>
<td align="left">Spurious correlation</td>
<td align="left">High for spurious x2</td>
<td align="left">Low for spurious x2</td>
</tr>
<tr class="even">
<td align="left">sim_dgp_mediated</td>
<td align="left">Mediation effects</td>
<td align="left">Shows total effects</td>
<td align="left">Shows direct effects</td>
</tr>
<tr class="odd">
<td align="left">sim_dgp_confounded</td>
<td align="left">Confounding</td>
<td align="left">Biased upward</td>
<td align="left">Less biased</td>
</tr>
<tr class="even">
<td align="left">sim_dgp_interactions</td>
<td align="left">Interaction effects</td>
<td align="left">Low (no main effects)</td>
<td align="left">High (captures interactions)</td>
</tr>
<tr class="odd">
<td align="left">sim_dgp_independent</td>
<td align="left">Baseline (no challenges)</td>
<td align="left">Accurate</td>
<td align="left">Accurate</td>
</tr>
<tr class="even">
<td align="left">sim_dgp_ewald</td>
<td align="left">Mixed effects</td>
<td align="left">Mixed</td>
<td align="left">Mixed</td>
</tr>
</tbody>
</table>
</div>
<div class="section level2">
<h2 id="correlated-features-dgp">1. Correlated Features DGP<a class="anchor" aria-label="anchor" href="#correlated-features-dgp"></a>
</h2>
<p>This DGP creates a highly correlated spurious predictor to illustrate
the fundamental difference between marginal and conditional importance
methods.</p>
<div class="section level3">
<h3 id="mathematical-model">Mathematical Model<a class="anchor" aria-label="anchor" href="#mathematical-model"></a>
</h3>
<p><span class="math display">\[X_1 \sim N(0,1)\]</span> <span class="math display">\[X_2 = X_1 + \varepsilon_2, \quad \varepsilon_2
\sim N(0, 0.05^2)\]</span> <span class="math display">\[X_3 \sim N(0,1),
\quad X_4 \sim N(0,1)\]</span> <span class="math display">\[Y = 2 \cdot
X_1 + X_3 + \varepsilon\]</span></p>
<p>where <span class="math inline">\(\varepsilon \sim N(0,
0.2^2)\)</span>.</p>
</div>
<div class="section level3">
<h3 id="causal-structure">Causal Structure<a class="anchor" aria-label="anchor" href="#causal-structure"></a>
</h3>
<div class="figure">
<div class="grViz html-widget html-fill-item" id="htmlwidget-ac96cb3ee4656e2e9ec3" style="width:960px;height:384px;"></div>
<script type="application/json" data-for="htmlwidget-ac96cb3ee4656e2e9ec3">{"x":{"diagram":"\n  digraph Correlated {\n    rankdir=LR;\n    graph [ranksep=1.5];\n    node [shape=circle, style=filled, fontsize=14, width=1.2];\n    \n    X1 [fillcolor=\"lightcoral\", label=\"X₁\n(β=2.0)\"];\n    X2 [fillcolor=\"pink\", label=\"X₂\n(β=0)\"];\n    X3 [fillcolor=\"lightblue\", label=\"X₃\n(β=1.0)\"];\n    X4 [fillcolor=\"lightgray\", label=\"X₄\n(β=0)\"];\n    Y [fillcolor=\"greenyellow\", label=\"Y\", width=1.5];\n    \n    X1 -> X2 [color=red, style=bold, label=\"≈1.0\"];\n    X1 -> Y [label=\"2.0\"];\n    X2 -> Y [style=dashed, color=gray, label=\"0\"];\n    X3 -> Y [label=\"1.0\"];\n    X4 -> Y [style=dashed, color=gray];\n    \n    {rank=source; X1; X3; X4}\n    {rank=same; X2}\n    {rank=sink; Y}\n  }","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script><p class="caption">
DAG for correlated features DGP
</p>
</div>
</div>
<div class="section level3">
<h3 id="usage-example">Usage Example<a class="anchor" aria-label="anchor" href="#usage-example"></a>
</h3>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">task</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sim_dgp_scenarios.html">sim_dgp_correlated</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">500</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Check correlation between X1 and X2</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span><span class="va">task</span><span class="op">$</span><span class="fu">data</span><span class="op">(</span><span class="op">)</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x1"</span>, <span class="st">"x2"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt;           x1        x2</span></span>
<span><span class="co">#&gt; x1 1.0000000 0.9986492</span></span>
<span><span class="co">#&gt; x2 0.9986492 1.0000000</span></span>
<span></span>
<span><span class="co"># True coefficients: x1=2.0, x2=0, x3=1.0, x4=0</span></span>
<span><span class="co"># Note: x2 is highly correlated with x1 but has NO causal effect!</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="expected-behavior">Expected Behavior<a class="anchor" aria-label="anchor" href="#expected-behavior"></a>
</h3>
<ul>
<li>
<strong>Marginal methods (PFI, Marginal SAGE)</strong>: Will falsely
assign high importance to x2 because permuting it breaks the correlation
with x1, creating unrealistic data that confuses the model</li>
<li>
<strong>Conditional methods (CFI, Conditional SAGE)</strong>: Should
correctly assign near-zero importance to x2 because conditional sampling
preserves the correlation, revealing that x2 adds no information beyond
what x1 provides</li>
<li>
<strong>Key insight</strong>: x2 is a spurious predictor - it
appears predictive due to correlation with x1 but has no causal effect
on y</li>
</ul>
</div>
</div>
<div class="section level2">
<h2 id="mediated-effects-dgp">2. Mediated Effects DGP<a class="anchor" aria-label="anchor" href="#mediated-effects-dgp"></a>
</h2>
<p>This DGP demonstrates the difference between total and direct causal
effects. Some features affect the outcome only through mediators.</p>
<div class="section level3">
<h3 id="mathematical-model-1">Mathematical Model<a class="anchor" aria-label="anchor" href="#mathematical-model-1"></a>
</h3>
<p><span class="math display">\[\text{exposure} \sim N(0,1), \quad
\text{direct} \sim N(0,1)\]</span> <span class="math display">\[\text{mediator} = 0.8 \cdot \text{exposure} + 0.6
\cdot \text{direct} + \varepsilon_m\]</span> <span class="math display">\[Y = 1.5 \cdot \text{mediator} + 0.5 \cdot
\text{direct} + \varepsilon\]</span></p>
<p>where <span class="math inline">\(\varepsilon_m \sim N(0,
0.3^2)\)</span> and <span class="math inline">\(\varepsilon \sim N(0,
0.2^2)\)</span>.</p>
</div>
<div class="section level3">
<h3 id="causal-structure-1">Causal Structure<a class="anchor" aria-label="anchor" href="#causal-structure-1"></a>
</h3>
<div class="figure">
<div class="grViz html-widget html-fill-item" id="htmlwidget-e5c8c404fe174e4c81bd" style="width:960px;height:384px;"></div>
<script type="application/json" data-for="htmlwidget-e5c8c404fe174e4c81bd">{"x":{"diagram":"\n  digraph Mediated {\n    rankdir=LR;\n    graph [ranksep=1.2];\n    node [shape=circle, style=filled, fontsize=14, width=1.2];\n    \n    E [fillcolor=\"orange\", label=\"Exposure\n(β=0)\"];\n    D [fillcolor=\"lightblue\", label=\"Direct\n(β=0.5)\"];\n    M [fillcolor=\"yellow\", label=\"Mediator\n(β=1.5)\"];\n    N [fillcolor=\"lightgray\", label=\"Noise\n(β=0)\"];\n    Y [fillcolor=\"greenyellow\", label=\"Y\", width=1.5];\n    \n    E -> M [label=\"0.8\", color=purple, penwidth=2];\n    D -> M [label=\"0.6\", color=blue];\n    D -> Y [label=\"0.5\", color=blue];\n    M -> Y [label=\"1.5\", color=purple, penwidth=2];\n    N -> Y [style=dashed, color=gray];\n    \n    {rank=source; E; D; N}\n    {rank=same; M}\n    {rank=sink; Y}\n  }","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script><p class="caption">
DAG for mediated effects DGP
</p>
</div>
</div>
<div class="section level3">
<h3 id="usage-example-1">Usage Example<a class="anchor" aria-label="anchor" href="#usage-example-1"></a>
</h3>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">task</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sim_dgp_scenarios.html">sim_dgp_mediated</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">500</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Calculate total effect of exposure</span></span>
<span><span class="co"># Total effect = 0.8 * 1.5 = 1.2 (through mediator)</span></span>
<span><span class="co"># Direct effect = 0 (no direct path to Y)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="expected-behavior-1">Expected Behavior<a class="anchor" aria-label="anchor" href="#expected-behavior-1"></a>
</h3>
<ul>
<li>
<strong>PFI</strong>: Shows total effects (exposure appears
important with effect ≈ 1.2)</li>
<li>
<strong>CFI</strong>: Shows direct effects (exposure appears
unimportant when conditioning on mediator)</li>
<li>
<strong>RFI with mediator</strong>: Should show direct effects
similar to CFI</li>
</ul>
</div>
</div>
<div class="section level2">
<h2 id="confounding-dgp">3. Confounding DGP<a class="anchor" aria-label="anchor" href="#confounding-dgp"></a>
</h2>
<p>This DGP includes a confounder that affects both features and the
outcome.</p>
<div class="section level3">
<h3 id="mathematical-model-2">Mathematical Model<a class="anchor" aria-label="anchor" href="#mathematical-model-2"></a>
</h3>
<p><span class="math display">\[H \sim N(0,1) \quad
\text{(confounder)}\]</span> <span class="math display">\[X_1 = H +
\varepsilon_1, \quad X_2 = H + \varepsilon_2\]</span> <span class="math display">\[\text{proxy} = H + \varepsilon_p, \quad
\text{independent} \sim N(0,1)\]</span> <span class="math display">\[Y =
H + 0.5 \cdot X_1 + 0.5 \cdot X_2 + \text{independent} +
\varepsilon\]</span></p>
<p>where all <span class="math inline">\(\varepsilon \sim N(0,
0.5^2)\)</span> independently.</p>
</div>
<div class="section level3">
<h3 id="causal-structure-2">Causal Structure<a class="anchor" aria-label="anchor" href="#causal-structure-2"></a>
</h3>
<div class="figure">
<div class="grViz html-widget html-fill-item" id="htmlwidget-36aa3d2a04d42bbc2145" style="width:960px;height:480px;"></div>
<script type="application/json" data-for="htmlwidget-36aa3d2a04d42bbc2145">{"x":{"diagram":"\n  digraph Confounded {\n    rankdir=LR;\n    graph [ranksep=1.2, nodesep=0.8];\n    node [shape=circle, style=filled, fontsize=14, width=1.2];\n    \n    H [fillcolor=\"red\", label=\"H\n(Confounder)\", style=\"filled,dashed\"];\n    X1 [fillcolor=\"lightcoral\", label=\"X₁\n(β=0.5)\"];\n    X2 [fillcolor=\"lightcoral\", label=\"X₂\n(β=0.5)\"];\n    P [fillcolor=\"pink\", label=\"Proxy\n(β=0)\"];\n    I [fillcolor=\"lightblue\", label=\"Independent\n(β=1.0)\"];\n    Y [fillcolor=\"greenyellow\", label=\"Y\", width=1.5];\n    \n    H -> X1 [color=red, label=\"1.0\"];\n    H -> X2 [color=red, label=\"1.0\"];\n    H -> P [color=red, style=dashed, label=\"1.0\"];\n    H -> Y [color=red, label=\"1.0\", penwidth=2];\n    X1 -> Y [label=\"0.5\"];\n    X2 -> Y [label=\"0.5\"];\n    I -> Y [label=\"1.0\"];\n    \n    {rank=source; H}\n    {rank=same; X1; X2; P; I}\n    {rank=sink; Y}\n  }","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script><p class="caption">
DAG for confounding DGP
</p>
</div>
</div>
<div class="section level3">
<h3 id="usage-example-2">Usage Example<a class="anchor" aria-label="anchor" href="#usage-example-2"></a>
</h3>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="co"># Hidden confounder scenario (default)</span></span>
<span><span class="va">task_hidden</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sim_dgp_scenarios.html">sim_dgp_confounded</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">500</span>, hidden <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">task_hidden</span><span class="op">$</span><span class="va">feature_names</span> <span class="co"># proxy available but not confounder</span></span>
<span><span class="co">#&gt; [1] "independent" "proxy"       "x1"          "x2"</span></span>
<span></span>
<span><span class="co"># Observable confounder scenario</span></span>
<span><span class="va">task_observed</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sim_dgp_scenarios.html">sim_dgp_confounded</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">500</span>, hidden <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">task_observed</span><span class="op">$</span><span class="va">feature_names</span> <span class="co"># both confounder and proxy available</span></span>
<span><span class="co">#&gt; [1] "confounder"  "independent" "proxy"       "x1"          "x2"</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="expected-behavior-2">Expected Behavior<a class="anchor" aria-label="anchor" href="#expected-behavior-2"></a>
</h3>
<ul>
<li>
<strong>PFI</strong>: Will show inflated importance for x1 and x2
due to confounding</li>
<li>
<strong>CFI</strong>: Should partially account for confounding
through conditional sampling</li>
<li>
<strong>RFI conditioning on proxy</strong>: Should reduce
confounding bias</li>
</ul>
</div>
</div>
<div class="section level2">
<h2 id="interaction-effects-dgp">4. Interaction Effects DGP<a class="anchor" aria-label="anchor" href="#interaction-effects-dgp"></a>
</h2>
<p>This DGP demonstrates a pure interaction effect where features have
no main effects.</p>
<div class="section level3">
<h3 id="mathematical-model-3">Mathematical Model<a class="anchor" aria-label="anchor" href="#mathematical-model-3"></a>
</h3>
<p><span class="math display">\[Y = 2 \cdot X_1 \cdot X_2 + X_3 +
\varepsilon\]</span></p>
<p>where <span class="math inline">\(X_j \sim N(0,1)\)</span>
independently and <span class="math inline">\(\varepsilon \sim N(0,
0.5^2)\)</span>.</p>
</div>
<div class="section level3">
<h3 id="causal-structure-3">Causal Structure<a class="anchor" aria-label="anchor" href="#causal-structure-3"></a>
</h3>
<div class="figure">
<div class="grViz html-widget html-fill-item" id="htmlwidget-febe03efa1a2d8d52a86" style="width:960px;height:384px;"></div>
<script type="application/json" data-for="htmlwidget-febe03efa1a2d8d52a86">{"x":{"diagram":"\n  digraph Interaction {\n    rankdir=LR;\n    graph [ranksep=1.2];\n    node [shape=circle, style=filled, fontsize=14, width=1.2];\n    \n    X1 [fillcolor=\"orange\", label=\"X₁\n(β=0)\"];\n    X2 [fillcolor=\"orange\", label=\"X₂\n(β=0)\"];\n    X3 [fillcolor=\"lightblue\", label=\"X₃\n(β=1.0)\"];\n    N1 [fillcolor=\"lightgray\", label=\"N₁\n(β=0)\"];\n    N2 [fillcolor=\"lightgray\", label=\"N₂\n(β=0)\"];\n    Y [fillcolor=\"greenyellow\", label=\"Y\", width=1.5];\n    INT [fillcolor=\"red\", shape=diamond, label=\"X₁×X₂\n(β=2.0)\", width=1.5];\n    \n    X1 -> INT [color=red, penwidth=2];\n    X2 -> INT [color=red, penwidth=2];\n    INT -> Y [color=red, label=\"2.0\", penwidth=2];\n    X3 -> Y [label=\"1.0\"];\n    N1 -> Y [style=dashed, color=gray];\n    N2 -> Y [style=dashed, color=gray];\n    \n    {rank=source; X1; X2; X3; N1; N2}\n    {rank=same; INT}\n    {rank=sink; Y}\n  }","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script><p class="caption">
DAG for interaction effects DGP
</p>
</div>
</div>
<div class="section level3">
<h3 id="usage-example-3">Usage Example<a class="anchor" aria-label="anchor" href="#usage-example-3"></a>
</h3>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">task</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sim_dgp_scenarios.html">sim_dgp_interactions</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">500</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Note: X1 and X2 have NO main effects</span></span>
<span><span class="co"># Their importance comes ONLY through their interaction</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="expected-behavior-3">Expected Behavior<a class="anchor" aria-label="anchor" href="#expected-behavior-3"></a>
</h3>
<ul>
<li>
<strong>PFI</strong>: Should assign near-zero importance to x1 and
x2 (no marginal effect)</li>
<li>
<strong>CFI</strong>: Should capture the interaction and assign high
importance to x1 and x2</li>
<li>
<strong>LOCO</strong>: May show high importance for x1 and x2
(removing either breaks the interaction)</li>
<li>
<strong>LOCI</strong>: Should show near-zero importance for x1 and
x2 (individually useless)</li>
</ul>
</div>
</div>
<div class="section level2">
<h2 id="independent-features-dgp-baseline">5. Independent Features DGP (Baseline)<a class="anchor" aria-label="anchor" href="#independent-features-dgp-baseline"></a>
</h2>
<p>This is a baseline scenario where all features are independent and
their effects are additive. All importance methods should give similar
results.</p>
<div class="section level3">
<h3 id="mathematical-model-4">Mathematical Model<a class="anchor" aria-label="anchor" href="#mathematical-model-4"></a>
</h3>
<p><span class="math display">\[Y = 2.0 \cdot X_1 + 1.0 \cdot X_2 + 0.5
\cdot X_3 + \varepsilon\]</span></p>
<p>where <span class="math inline">\(X_j \sim N(0,1)\)</span>
independently and <span class="math inline">\(\varepsilon \sim N(0,
0.2^2)\)</span>.</p>
</div>
<div class="section level3">
<h3 id="causal-structure-4">Causal Structure<a class="anchor" aria-label="anchor" href="#causal-structure-4"></a>
</h3>
<div class="figure">
<div class="grViz html-widget html-fill-item" id="htmlwidget-1fb4450895fe099f74a1" style="width:960px;height:384px;"></div>
<script type="application/json" data-for="htmlwidget-1fb4450895fe099f74a1">{"x":{"diagram":"\n  digraph Independent {\n    rankdir=LR;\n    graph [ranksep=1.5];\n    node [shape=circle, style=filled, fontsize=14, width=1.2];\n    \n    X1 [fillcolor=\"lightblue\", label=\"X₁\n(β=2.0)\"];\n    X2 [fillcolor=\"lightblue\", label=\"X₂\n(β=1.0)\"];\n    X3 [fillcolor=\"lightblue\", label=\"X₃\n(β=0.5)\"];\n    N1 [fillcolor=\"lightgray\", label=\"N₁\n(β=0)\"];\n    N2 [fillcolor=\"lightgray\", label=\"N₂\n(β=0)\"];\n    Y [fillcolor=\"greenyellow\", label=\"Y\", width=1.5];\n    \n    X1 -> Y [label=\"2.0\", penwidth=3];\n    X2 -> Y [label=\"1.0\", penwidth=2];\n    X3 -> Y [label=\"0.5\"];\n    N1 -> Y [style=dashed, color=gray];\n    N2 -> Y [style=dashed, color=gray];\n    \n    {rank=source; X1; X2; X3; N1; N2}\n    {rank=sink; Y}\n  }","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script><p class="caption">
DAG for independent features DGP
</p>
</div>
</div>
<div class="section level3">
<h3 id="usage-example-4">Usage Example<a class="anchor" aria-label="anchor" href="#usage-example-4"></a>
</h3>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">task</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sim_dgp_scenarios.html">sim_dgp_independent</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">500</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># All methods should rank features consistently:</span></span>
<span><span class="co"># important1 &gt; important2 &gt; important3 &gt; unimportant1,2 ≈ 0</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="expected-behavior-4">Expected Behavior<a class="anchor" aria-label="anchor" href="#expected-behavior-4"></a>
</h3>
<ul>
<li>
<strong>All methods</strong>: Should rank features consistently by
their true effect sizes</li>
<li>
<strong>Ground truth</strong>: important1 (2.0) &gt; important2
(1.0) &gt; important3 (0.5) &gt; unimportant1,2 (0)</li>
</ul>
</div>
</div>
<div class="section level2">
<h2 id="ewald-et-al--2024-dgp">6. Ewald et al. (2024) DGP<a class="anchor" aria-label="anchor" href="#ewald-et-al--2024-dgp"></a>
</h2>
<p>Reproduces the data generating process from Ewald et al. (2024) for
benchmarking feature importance methods. Includes correlated features
and interaction effects.</p>
<div class="section level3">
<h3 id="mathematical-model-5">Mathematical Model<a class="anchor" aria-label="anchor" href="#mathematical-model-5"></a>
</h3>
<p><span class="math display">\[X_1, X_3, X_5 \sim
\text{Uniform}(0,1)\]</span> <span class="math display">\[X_2 = X_1 +
\varepsilon_2, \quad \varepsilon_2 \sim N(0, 0.001)\]</span> <span class="math display">\[X_4 = X_3 + \varepsilon_4, \quad \varepsilon_4
\sim N(0, 0.1)\]</span> <span class="math display">\[Y = X_4 + X_5 + X_4
\cdot X_5 + \varepsilon, \quad \varepsilon \sim N(0, 0.1)\]</span></p>
</div>
<div class="section level3">
<h3 id="causal-structure-5">Causal Structure<a class="anchor" aria-label="anchor" href="#causal-structure-5"></a>
</h3>
<div class="figure">
<div class="grViz html-widget html-fill-item" id="htmlwidget-10b3b7155e8045a1b2ad" style="width:960px;height:384px;"></div>
<script type="application/json" data-for="htmlwidget-10b3b7155e8045a1b2ad">{"x":{"diagram":"\n  digraph Ewald {\n    rankdir=LR;\n    graph [ranksep=1.2];\n    node [shape=circle, style=filled, fontsize=14, width=1.2];\n    \n    X1 [fillcolor=\"lightgray\", label=\"X₁\n(β=0)\"];\n    X2 [fillcolor=\"lightgray\", label=\"X₂\n(β=0)\"];\n    X3 [fillcolor=\"lightgray\", label=\"X₃\n(β=0)\"];\n    X4 [fillcolor=\"lightblue\", label=\"X₄\n(β=1.0)\"];\n    X5 [fillcolor=\"lightblue\", label=\"X₅\n(β=1.0)\"];\n    Y [fillcolor=\"greenyellow\", label=\"Y\", width=1.5];\n    INT [fillcolor=\"red\", shape=diamond, label=\"X₄×X₅\n(β=1.0)\", width=1.5];\n    \n    X1 -> X2 [color=gray, label=\"≈1.0\"];\n    X3 -> X4 [color=gray, label=\"≈1.0\"];\n    X4 -> Y [label=\"1.0\"];\n    X5 -> Y [label=\"1.0\"];\n    X4 -> INT [color=red];\n    X5 -> INT [color=red];\n    INT -> Y [color=red, label=\"1.0\"];\n    \n    {rank=source; X1; X3; X5}\n    {rank=same; X2; X4}\n    {rank=same; INT}\n    {rank=sink; Y}\n  }","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script><p class="caption">
DAG for Ewald et al. (2024) DGP
</p>
</div>
</div>
<div class="section level3">
<h3 id="usage-example-5">Usage Example<a class="anchor" aria-label="anchor" href="#usage-example-5"></a>
</h3>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">task</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sim_dgp_ewald.html">sim_dgp_ewald</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">500</span><span class="op">)</span></span>
<span><span class="va">task</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">──</span> <span style="color: #0000BB; font-weight: bold;">&lt;TaskRegr&gt;</span><span style="font-weight: bold;"> (500x6)</span> <span style="color: #00BBBB;">──────────────────────────────────────────────────────────</span></span></span>
<span><span class="co">#&gt; • Target: y</span></span>
<span><span class="co">#&gt; • Properties: -</span></span>
<span><span class="co">#&gt; • Features (5):</span></span>
<span><span class="co">#&gt;   • dbl (5): x1, x2, x3, x4, x5</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="comparing-methods-on-different-dgps">Comparing Methods on Different DGPs<a class="anchor" aria-label="anchor" href="#comparing-methods-on-different-dgps"></a>
</h2>
<p>Here’s a practical example comparing PFI and CFI on the correlated
features DGP:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">task</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sim_dgp_scenarios.html">sim_dgp_correlated</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span></span>
<span><span class="va">learner</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html" class="external-link">lrn</a></span><span class="op">(</span><span class="st">"regr.ranger"</span><span class="op">)</span></span>
<span><span class="va">measure</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html" class="external-link">msr</a></span><span class="op">(</span><span class="st">"regr.mse"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Compute PFI</span></span>
<span><span class="va">pfi</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/PFI.html">PFI</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">task</span>, <span class="va">learner</span>, <span class="va">measure</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> No <span style="color: #0000BB;">&lt;Resampling&gt;</span> provided</span></span>
<span><span class="co">#&gt; Using `resampling = rsmp("holdout")` with default `ratio = 0.67`.</span></span>
<span><span class="va">pfi</span><span class="op">$</span><span class="fu">compute</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">pfi</span><span class="op">$</span><span class="fu">importance</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Key: &lt;feature&gt;</span></span>
<span><span class="co">#&gt;    feature  importance</span></span>
<span><span class="co">#&gt;     &lt;char&gt;       &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1:      x1 2.121359858</span></span>
<span><span class="co">#&gt; 2:      x2 2.225174152</span></span>
<span><span class="co">#&gt; 3:      x3 1.482607702</span></span>
<span><span class="co">#&gt; 4:      x4 0.001266445</span></span>
<span></span>
<span><span class="co"># Compute CFI</span></span>
<span><span class="va">cfi</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/CFI.html">CFI</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">task</span>, <span class="va">learner</span>, <span class="va">measure</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> No <span style="color: #0000BB;">&lt;ConditionalSampler&gt;</span> provided, using <span style="color: #0000BB;">&lt;ARFSampler&gt;</span> with default settings.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> No <span style="color: #0000BB;">&lt;Resampling&gt;</span> provided</span></span>
<span><span class="co">#&gt; Using `resampling = rsmp("holdout")` with default `ratio = 0.67`.</span></span>
<span><span class="va">cfi</span><span class="op">$</span><span class="fu">compute</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">cfi</span><span class="op">$</span><span class="fu">importance</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Key: &lt;feature&gt;</span></span>
<span><span class="co">#&gt;    feature   importance</span></span>
<span><span class="co">#&gt;     &lt;char&gt;        &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1:      x1 0.1640989568</span></span>
<span><span class="co">#&gt; 2:      x2 0.0801231825</span></span>
<span><span class="co">#&gt; 3:      x3 1.3948312601</span></span>
<span><span class="co">#&gt; 4:      x4 0.0001695743</span></span></code></pre></div>
<p>Expected pattern: PFI falsely shows high importance for spurious x2
while CFI correctly shows near-zero importance for x2</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://lukasburk.de" class="external-link">Lukas Burk</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
